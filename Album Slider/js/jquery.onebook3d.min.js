/**
 * jquery plugin 'onebook3d', http://onebook3d.riadesign.ru
 */
 
 (function(e){e.onebook=function(t,n,r){var i="ONEBOOK3DGLOBALDATASTORAGE",r=r&&r!==e&&r.size?r:false;if(!window[i]){window[i]={FLIPS:{},NUMBER:0,BOOKS:[],CURRENT:false,SUPERBOOK:false,SKIN:{},queueBooksBuilding:[],buildNextBook:function(){window[i].buildingNowFlag=true;var t=window[i].queueBooksBuilding.shift();if(t){var n=e.extend(true,{},s);n.init(t.arrSrc,t.options,t.target)}else{window[i].buildingNowFlag=false}}}}var s={init:function(t,n,r){var s=this;this.IMAGES_SRC=t;this.$TARGET=r;this.startIndex=1e3+20*window[i].NUMBER;this.options=this.set_options(n);o.init(e.extend(this.options,{onReady:function(e){s.initWithData(e)}}))},initWithData:function(t){var n=this,r=this.startIndex;var s={defineSkin:function(e){var t={dark:"dark",light:"light"};return t[e&&e.toLowerCase()]||"dark"},defineSkinArray:function(e){if(typeof e==="object"){var t=s.defineSkin(e[0]);var n=s.defineSkin(e[1]);return[t,n]}else{return[s.defineSkin(e)]}},defineLanguage:function(e){var t={en:0,ru:1};return t[e.toLowerCase()]||0},defineBorder:function(e){var e=parseInt(e,10);return e<101?e:30},defineSlope:function(e){var e=parseInt(e,10);return e<3?e:0}};this.CFG={HOME_LINK:"http://www.onebook3d.riadesign.ru",DIVIDE_IMAGES:false,PAGE_DEFAULT_COLOR:this.options.pageColor,BORDER:s.defineBorder(this.options.border),ARR_SLOPE_ANGLES:[0,20,40],START_SLOPE_MODE:s.defineSlope(this.options.slope),ROTATE_CENTER_OFFSET:1.8,SHEETS_SENSIVITY:8,PASPARTU_BEHAVIORS_PARAM:{width:0,height:80},SPACE_AROUND_STAGE:{horizontal:20,vertical:20},DRAG_PARAM:{px_per_persent:3},NUMBEROF_PRELOAD_SHEETS:3,MAX_SCREEN_SIZE:{width:2e3,height:1200},ICONS_PANEL:{tiny:{height:101,width:265,noTitle:20,betweenIcons:2,pageNumbers:{width:83,fontSize:16}},small:{height:101,width:410,noTitle:20,betweenIcons:8,pageNumbers:{width:102,fontSize:18}},middle:{height:101,width:470,noTitle:20,betweenIcons:6,pageNumbers:{width:92,fontSize:16}},large:{height:140,width:700,noTitle:30,betweenIcons:10,pageNumbers:{width:105,fontSize:16}},titleSection:65,overlay_pr:.8},ICONS_SIZE:{big:50,small:36},MAX_FRAME_DRAGGABLE:60,MAX_MOUSE_SPEED_X:90,ZOOM_WAITER_SIZE:60,LANGUAGE:s.defineLanguage(this.options.language),ZINDEX:{bookBackground:r,bookStage:r+5,bookIconsPanel:r+10,bookSaveMenu:r+20,zoomLayer:r+2e3}};this.GIF="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";this.AJAX_LOADER="data:image/gif;base64,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";this.SRC_ICONS_BIG="data:image/png;base64,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";this.SRC_ICONS_MINI="data:image/png;base64,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";this.SRC_HOME_LINK="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAeCAYAAABE4bxTAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACG0lEQVR4nO2WTyhlcRTHD1n4lzIlTQ2lsJCReMkMCtGUjYXsZjGbKavJYhaKrGhqLG1kKaVRSqKsZKOIhfHv6SVmUrOippmUxYjv1zkvr+ve7nW9pOae+nTfve/ec77n/O7t9xWJ4nGR9dzyxsEoeJkmITEwDg68bsgMkOQHWAbToDGEiCLQD76DYbACrkPkuY1dO1L4O7AANkCv+DdTJ9oEc3wGxS5570WG43xH7tTniS7VDEiILt86yAeDoB6MgDlHjhLwBZSKLjdzNoAKUA4qwRvLWQh+gxovQVT+OuWca/0RVFuiZhO0Zv81WVLecwK6wZjoJAus8B9rJGEcgyXLea+m39t+ZcXXUq7lWqFW8Er0HdkEP206f63Rb+ATuHTJG/gdcq6t51qnBCf03op0SbAPZdfjd1oEJeMhX46noCDdPGlEgvwiEuQXkSC/iAT5hZ8g7lt9IDtN9egeBkQ36FCC3opumNtgCLwIISLppebBouhmGwv6sNfexY7o+mg5JkGZyz3OvYxT5W6/J2rUGoLUdNqPM1GrmWMFaJ7iJmQfdIpObdYSfQWHjhzM2WdipkCbNVQramHpgzj15LR/pT7sNGjOoLWosiQ80lPzvaKNpe9pB6uiDpLn9EkTYEvUjMWMI2t0xxo5BeduBf0EuQWXgk6xBXSILh+vsWNOmA6RU10xsRTxL0Sd0EGr+gFcgB7RCUbx/8QNBj9rFr9f954AAAAASUVORK5CYII=";this.SRC_HELP_ARROW="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAAaCAYAAAAT6cSuAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByklEQVR4nO2XOUtDQRSFryKiQUURSVxQERcQ10qwEhEULKwsUoudP8FGLS0tBAs7xUJE0NrCykIRcSmMjVjEfQVRweUc7oQEMQmEN04IOfDx3iTzZs7cmbnznkhWaacC1wZsaQjcgFrXRmyIs3YIdkG+Yy9W1AiewKJrI7Y0DD7BuGsjtjQD3kGPayM2lAs2QRgEHHuxohIQAjuSoQmmGbyABddGbGlE4iQYrt1R0PbfjjzWpPyRYErBJfgG12AVTIj7wTLorSAIZsEWuAXzCeofgDkW8syPj6AKdIB+0AemQRl4BSfmoSPRt4Mz0Qz14cEA6KFS9HWKe4cHdAtoMvc+0w897IM1sBGnrW7TxhILOUk67QKdojPYLjr4ipg6d6KDvBCNKHVlrl/gAZSbMk0Wm3aZtv2GyP8UA8nAhQynEg1qskBycvZM3UH2n2hw8URDdaBaNOKRa0CiK8H/65k30dcliqvkXjQIJBzDeQp+qCKwDQpF99tziu2knbjP1kW/FOrdWvFeTDTMkL2ujXitMdEMH3RtxGsxq3PGplwb8VoNopl6RXTPZYyYGY9Fv8R9jr14rmXRzFjj2ojX4jnKQ3rAtZGsbOoHTqZUb7lFI8sAAAAASUVORK5CYII=";this.BOOK_INTERNAL=this.$TARGET?true:false;this.PRE_NAME="OneBook3d_"+Math.floor(Math.random()*1e6)+"_";window[i].BOOKS[this.PRE_NAME]=this;window[i].CURRENT=this.PRE_NAME;if(!this.BOOK_INTERNAL){window[i].SUPERBOOK=this.PRE_NAME}this.SKIN_ARRAY=s.defineSkinArray(this.options.skin);var o=!this.BOOK_INTERNAL&&this.SKIN_ARRAY.length>1?1:0;this.DARK_MODE=this.SKIN_ARRAY[o]==="light"?false:true;this.addStyle();this.$gStage=this.getStage();this.$gContainter=e("#"+this.divNames.book_container);this.$gBookLoader=e("#"+this.divNames.book_loader);this.LNG={save:["Save","Сохранить"],light:["Light","Светлый"],dark:["Dark","Темный"],prev:["Prev","Назад"],next:["Next","Далее"],zoom:["Zoom","Масштаб"],zoomclose:["Zoom","Масштаб"],slope:["Slope","Наклон"],fromfullscreen:["Smaller","Уменьшить"],tofullscreen:["Larger","Увеличить"],close:["Close","Закрыть"],left:["Left","Слева"],right:["Right","Справа"],toStart:["To start","В начало"],toEnd:["To end","В конец"],hlpGoToHomelink:["Open homepage","Открыть домашнюю страницу"],hlpClickToOpen:["Click to open","Открой меня"],hlpUseMousewheel:["Use mouse wheel<br>for easy viewing","Используйте колесо мыши<br>для листания"],askSaveImage:["Select the page to save, please","Какое изображение сохранить?"],askSaveLinks:['<a href="#">Left</a> or <a href="#">Right</a>','<a href="#">Левое</a> или <a href="#">Правое</a>']};this.BTNS_OFFSET={save:[["-100px"]],skin:[["-50px","0px"],["dark","light"],"DARK_MODE"],prev:[["-150px"]],zoom:[["-200px"]],next:[["-250px"]],slope:[["-300px"]],togglebook:[["-350px","-400px"],["toStart","toEnd"],"START_FROM_END"],close:[["-450px"]],zoomclose:[["-450px"]]};this.BTNS_MINI_OFFSET={save:[["-72px"]],skin:[["-36px","0px"],["dark","light"],"DARK_MODE"],prev:[["-108px"]],zoom:[["-144px"]],next:[["-180px"]],slope:[["-216px"]],tofullscreen:[["-252px"]],fromfullscreen:[["-288px"]],togglebook:[["-324px","-360px"],["toStart","toEnd"],"START_FROM_END"],close:[["-396px"]],zoomclose:[["-396px"]]};this.PANEL_TYPE="";this.LARGE_ICONS=false;this.FRDATA=t;this.FIRST_FRAME=0;this.ARR_PAGES_SRC=[];this.ARR_PAGES_TITLE=[];this.getSrcAndTitles(this.IMAGES_SRC);if(!this.CFG.DIVIDE_IMAGES&&this.ARR_PAGES_SRC.length%2>0){this.ARR_PAGES_SRC.push(this.CFG.PAGE_DEFAULT_COLOR)}this.START_FROM_END=0;this.START_PAGE=this.options.startPage;this.GSCALE=1;this.ALL_PAGES_MAP=[];this.ALLSHEETS=[];this.$ARR_SHEETS=[];this.FIRST_IMAGE_SIZE={w:0,h:0};this.SHEETS_WAS_BUILT=[];this.SHEET_DISPLAYED=null;this.QUEUE_IMAGES_LOADED=[];this.IMG_NOW_LOADING=[];this.NOW_LOADING_COUNTER=0;this.IMG_NOW_LOADING_FOR_ZOOM=[];if(!this.options.cesh){this.addCeshNames(Math.floor(Math.random()*1e4))}this.ANIMATION_SLOPE=false;this.ZOOM_MODE=0;this.STAGE={width:0,height:0};this.STAGE_CENTER={top:0,left:0};this.STAGE_BOUNDING_BOX={width:0,height:0,top:0,left:0};this.MAX_BOUNDS={width:0,height:0,top:0,left:0};this.ENVIRON=this.getEnviron();!this.BOOK_INTERNAL&&n.build_background();this.bookLoaderShow("show");this.prepareBookSize();this.prepareIconsPanelSize();this.prepareSkinImages(function(){n.findBookSizeByFirstImage(function(){n.fit3dDataToBookSize()})})},set_options:function(t){var t=t;if(typeof t==="number"){switch(t){case 1:t={flip:"soft",border:25};break;case 2:t={skin:"light",slope:1};break;case 3:t={skin:"light",flip:"soft",startPage:6};break;default:t={};break}}return e.extend({language:"en",skin:"dark",bgDark:"",bgLight:"",pageColor:"white",border:30,typeAnimation:"",startPage:1,slope:0,flip:"basic",cesh:true},t||{})},prepareBookSize:function(){this.WINSIZE={width:e(window).width(),height:e(window).height()};this.TARGETSIZE=this.$TARGET?{left:this.$TARGET.offset().left,top:0,width:this.$TARGET.width(),height:100}:false;this.ZOOMSIZE={height:this.WINSIZE.height,width:this.WINSIZE.width,top:0,left:0}},prepareIconsPanelSize:function(){var e=this.CFG.ICONS_PANEL,t=this.$TARGET?this.TARGETSIZE:this.WINSIZE;if(this.BOOK_INTERNAL){if(t.width<e.tiny.width){return false}else if(t.width<e.small.width){this.LARGE_ICONS=false;this.PANEL_TYPE="tiny"}else{this.LARGE_ICONS=false;this.PANEL_TYPE="small"}}else{if(this.fsapi.isFullScreen()){if(t.width<e.large.width){return false}else{this.LARGE_ICONS=true;this.PANEL_TYPE="large"}}else{if(t.width<e.middle.width){return false}else{this.LARGE_ICONS=false;this.PANEL_TYPE="middle"}}}},getTotalSheets:function(){return this.ALLSHEETS.length},getEnviron:function(){var e=navigator.userAgent,t=e.indexOf("Chrome")!=-1,n=e.indexOf("Safari")!=-1,r=e.indexOf("OPR")!=-1,i=e.indexOf("WebKit")!=-1;var s={ios:navigator.userAgent.indexOf("iP")!=-1,android:navigator.userAgent.indexOf("Android")!=-1,firefox:navigator.userAgent.indexOf("Firefox")!=-1,windows:navigator.userAgent.indexOf("Windows")!=-1,mac:navigator.userAgent.indexOf("Macintosh")!=-1,webkit:i,safari:n&&!t,chrome:n&&t&&!r,opera:r,ipad:navigator.userAgent.indexOf("iPad")!=-1,iphone:navigator.userAgent.indexOf("iPhone")!=-1};s.touch=s.ios||s.android;return s},getSrcAndTitles:function(e){var e=e.slice()||[];var t=0;this.NO_ONE_TITLES=true;if(!e.length){return}for(var n=0,r=e.length;n<r;n++){if(typeof e[n]=="string"){this.ARR_PAGES_SRC.push(e[n]);this.ARR_PAGES_TITLE.push("")}else if(typeof e[n]=="object"&&e[n].length==2){t++;this.ARR_PAGES_SRC.push(e[n][0]);this.ARR_PAGES_TITLE.push(e[n][1])}}this.NO_ONE_TITLES=t?false:true},addStyle:function(){var e=this,t=this.PRE_NAME;this.divNames={background:t+"background",book_stage:t+"stage",book_help_layer:t+"help_layer",book_container:t+"stage_container",book_loader:t+"book_loader",book_icons_panel:t+"icons_panel",book_spread_title:t+"spread_title",book_page_numbers:t+"page_numbers",icons_container:t+"icons_container",zoom_layer:t+"zoom_layer",zoom_content:t+"zoom_content",zoom_title_spread:t+"zoom_title_spread",zoom_behavior_section:t+"zoom_behavior_section",zoom_buttons:t+"zoom_buttons",zoom_waiter:t+"zoom_waiter_layer",save_menu:t+"save_menu"};var n=function(t){var n=document.createElement("style");n.type="text/css";if(n.styleSheet){n.styleSheet.cssText=t}else{n.appendChild(document.createTextNode(t))}e.CSS=document.getElementsByTagName("head")[0].appendChild(n)};var r="#"+this.divNames.background,i="#"+this.divNames.book_stage,s="#"+this.divNames.book_container,o="#"+this.divNames.book_help_layer,u="#"+this.divNames.book_loader,a="."+this.divNames.book_spread_title,f="#"+this.divNames.book_page_numbers,l="#"+this.divNames.book_icons_panel,c="#"+this.divNames.zoom_layer,h="."+this.divNames.zoom_content,p="."+this.divNames.zoom_title_spread,d="#"+this.divNames.zoom_waiter;saveMenu="."+this.divNames.save_menu;var v=this.CFG.ZINDEX;var m="";m+=c+"{position:relative;}\n";m+=c+" .btn_title{font:12px arial;color:black;padding:5px;white-space:nowrap;}\n";m+=h+"{overflow:hidden;text-align:center;background:#e5e5e5;}\n";m+=h+" .zoom_pages{border-collapse:collapse;border:0px;background:white;}\n";m+=h+" .zoom_pages td{padding:0px;}\n";m+=p+"{border-top:1px solid white;}\n";m+=p+" p{font:14px arial;color:black;line-height:140%;margin:0px;}\n";m+=p+" p span{font:bold 14px arial;color:gray;margin-right:8px;}\n";m+=saveMenu+" h1{font:16px arial;color:white;}\n";m+=saveMenu+" p{font:16px arial;color:white;}\n";m+=saveMenu+" a{font:16px arial;color:white;}\n";m+=f+"{color:#b2b2b2;}\n";m+=f+".light{color:#555555;}\n";m+=[i+"{","position:absolute;left:0px;top:0px;","overflow:hidden;","-webkit-perspective:1000px;","-moz-perspective:1000px;","z-index:"+v.bookStage+";}\n"].join("");m+=[r+"{","position:fixed;left:0px;top:0px;right:0px;bottom:0px;",this.options.bgDark?"background:"+this.options.bgDark+";":"background:#282828;","z-index:"+v.bookBackground+";}\n"].join("");m+=[r+".light{",this.options.bgLight?"background:"+this.options.bgLight+";":"background:#d0d0d0;",";}\n"].join("");m+=[s+"{","width:100%; height:100%;","top:0px;left:0px;position:absolute;","-webkit-transform-style: preserve-3d;","-moz-transform-style: preserve-3d;","z-index:20;}\n"].join("");m+=[s+" div{","height:300px;","-webkit-transform-origin:left center;","-moz-transform-origin:left center;","-webkit-transform-style: preserve-3d;","-moz-transform-style: preserve-3d;}\n"].join("");m+=[s+" .all_edges{","-moz-perspective:5000px;-moz-transform-origin:left center;-moz-transform-style: preserve-3d;","}\n"].join("");m+=[s+" .wholeimage{","-webkit-transform-origin:left center;-moz-transform-origin:left center;","-webkit-transform-style:preserve-3d;-moz-transform-style: preserve-3d;","font:bold 20px arial;color:white;}\n"].join("");m+=[s+" .wholeimage,",s+" .wholeimage span,",s+" .wholeimage div{","}\n"].join("");m+=[s+" div .back, \n",s+" div .front, \n",s+" .front_image, \n",s+" .front_image>div, \n",s+" .back_image, \n",s+" .back_image>div {","-moz-transform-style: preserve-3d;","display:block;width:100%;height:100%;","top:0px;left:0px;position:absolute;}\n"].join("");m+=[o+"{","position:absolute;","outline: 1px solid transparent;","-webkit-transform:translate3d(0px,0px,-1px);","-moz-transform:translate3d(0px,0px,-1px);","z-index:0;}\n"].join("");m+=o+" a {text-decoration:none;}";m+=o+" a:hover {text-decoration:underline;}";m+=o+" p {padding:20px 20px 20px 0px;margin:0px;}";m+=o+" p span{display:block;margin-top:10px;}";m+=o+" .hlpLeftSide {border:1px solid #cccccc;border-right:none;}\n";m+=o+" .hlpRightSide {border:1px solid #cccccc;border-left:none;}\n";m+=o+" .hlpLeftSide p span[name=home_link]{width:36px;height:30px;margin:10px 0px 0px auto;opacity:0.8;}";m+=o+" .hlpLeftSide p span[name=click_to_open] a{font:21px arial;color:white;}";m+=o+" .hlpLeftSide p span[name=use_mousewheel]{font:12px arial;color:#d4d4d4;}";m+=o+" .hlpLeftSide p span[name=help_arrow]{width:55px;height:26px;margin:10px 0px 0px auto;opacity:0.8;}";m+=o+" .hlpRightSide p span[name=goto_start] a{font:18px arial;color:white;}";m+=o+" p.middleSize {padding:10px 10px 10px 0px;}";m+=o+" p.middleSize span{margin-top:5px;}";m+=o+" .hlpLeftSide p.middleSize span[name=click_to_open] a{font:16px arial;}";m+=o+" .hlpRightSide p.middleSize span[name=goto_start] a{font:14px arial;}";m+=o+".light .hlpLeftSide {border:1px solid #bfbfbf;border-right:none;}\n";m+=o+".light .hlpRightSide {border:1px solid #bfbfbf;border-left:none;}\n";m+=o+".light .hlpLeftSide p span[name=home_link]{opacity:0.4;}";m+=o+".light .hlpLeftSide p span[name=click_to_open] a{color:#656565;}";m+=o+".light .hlpLeftSide p span[name=use_mousewheel]{color:#656565;}";m+=o+".light .hlpLeftSide p span[name=help_arrow]{opacity:0.4;}";m+=o+".light .hlpRightSide p span[name=goto_start] a{color:#656565;}";m+=[u+"{",'background:white url("'+this.AJAX_LOADER+'") center no-repeat;',"position:absolute;top:0px;left:0px;width:90px;height:90px;","-moz-border-radius:15px;","border-radius:15px;","opacity:0.5;display:none;","z-index:100;}\n"].join("");m+=[d+"{","position:absolute;","width:100px;height:100px;","left:0px;top:0px;","z-index:300;}\n"].join("");m+=[l+"{","position:absolute;","top:0px;left:0px;text-align:center;","z-index:"+v.bookIconsPanel+";}\n"].join("");m+=l+" "+a+" p{font:14px arial;color:#aaaaaa;line-height:140%;margin:0px;}\n";m+=l+" "+a+" span{font:bold 14px arial;color:#ffffff;margin-right:8px;}\n";m+=l+".light "+a+" p{color:#000000;}\n";m+=l+".light "+a+" span{color:#888888;}\n";m+=l+" .btn_title{font:12px arial;color:#ffffff;padding:5px;white-space:nowrap;}\n";m+=l+".light .btn_title{color:black;}\n";m+=[".unselectable{","-webkit-user-select:none;","-khtml-user-select:none;","-moz-user-select:none;","user-select: none;"].join("");n(m)},getStage:function(){var t=this.divNames.book_stage;var n=this.divNames.book_container;var r=this.divNames.book_loader;var i=this.divNames.zoom_waiter;var s=e("#"+t);s.size()&&s.remove();var o=['<div id="'+t+'">','<div id="'+n+'"></div>','<div id="'+r+'" style="display:none;"></div>','<div id="'+i+'" style="display:none;"></div>',"</div>"].join("");e("body").append(o);return e("#"+t)},bookHide:function(){this.$gStage.hide();this.$gIconsPanel&&this.$gIconsPanel.hide()},bookShow:function(){this.$gStage.show();this.$gIconsPanel&&this.$gIconsPanel.show()},bgLoaderShow:function(e){var t=this.$gBookBackground&&this.$gBookBackground.find("div");if(e){if(t&&t.is(":hidden")){t.show()}}else{if(t&&t.is(":visible")){t.hide()}}},bookLoaderShow:function(e){if(e){if(this.$gBookLoader.is(":hidden")){this.$gBookLoader.show()}}else{if(this.$gBookLoader.is(":visible")){this.$gBookLoader.fadeOut()}}},exit:function(){if(this.TMR_RESIZE){clearTimeout(this.TMR_RESIZE);this.TMR_RESIZE=null}window[i].NUMBER-=1;window[i].SUPERBOOK=false;delete window[i].BOOKS[this.PRE_NAME];this.zoomOut();this.$gStage&&this.$gStage.remove();this.$gSaveMenu&&this.$gSaveMenu.remove();this.$gIconsPanel&&this.$gIconsPanel.remove();this.$gBookBackground&&this.$gBookBackground.fadeOut("normal",function(){this.remove()});this.CSS.remove();e(window).unbind("."+this.PRE_NAME);e(document).unbind("keyup."+this.PRE_NAME);var t=this.options.parentBook;var n=this.CURRENT.spread;var r=this.CURRENT.slope_mode;var s=function(){var e=window[i].BOOKS;for(var s in e){if(e.hasOwnProperty(s)){var o=s===t;var u=e[s];var a=u.isNeedResizeReposInternal();if(t&&o){var f=n?n*2:1;u.START_PAGE=f;u.slopeToggle(r);window[i].CURRENT=u.PRE_NAME;var l=u.CURRENT.spread!==n;if(a==="resize"){u.restart()}else{a==="reposition"&&u.restart(a);l&&u.gotoSpread(n)}}else{if(a){u.restart(a)}}}}};s()},restart:function(e){if(e==="reposition"){var t=this.TARGETSIZE;var n=this.STAGE;var r=Math.round((t.width-n.width)/2+t.left);var i=this.getIconsPanelWidth();var s=Math.round((t.width-i)/2+t.left);var o=Math.round((t.width-this.$gSaveMenu.width())/2+t.left);this.$gStage.css({left:r});this.$gIconsPanel.css({left:s});this.$gSaveMenu.css({left:o});this.prepareBookSize();this.calculateBounds()}else{this.zoomOut();this.GSCALE=1;this.SHEETS_WAS_BUILT=[];this.QUEUE_IMAGES_LOADED=[];this.IMG_NOW_LOADING=[];this.NOW_LOADING_COUNTER=0;this.prepareBookSize();this.prepareIconsPanelSize();this.fit3dDataToBookSize()}},gotoSpread:function(e){var t=this.getTotalSheets();if(!this.ZOOM_MODE&&!this.ANIMATION_FLAG){if(e===0){this.START_FROM_END=true;this.toggleBook()}else if(e===t){this.START_FROM_END=false;this.toggleBook()}else{this.CURRENT.spread=e;this.$gHelpLayer.find(".hlpLeftSide").css({opacity:0});this.$gHelpLayer.find(".hlpRightSide").css({opacity:0})}var n=this.SHEETS_WAS_BUILT;for(var r in n){if(n.hasOwnProperty(r)){this.deleteSheet(r)}}this.buildAndPreloadSheets();this.changeSpreadTitle();this.pageNumbersChange();var i=this.$G_ARR_BUTTONS["togglebook"];i&&i.update()}},prepareSkinImages:function(e){var t=this,n=window[i].SKIN;var r={invertCanvas:function(e){var t=e.getContext("2d");var n=t.getImageData(0,0,e.width,e.height);var r=n.data;for(var i=0;i<r.length;i+=4){r[i]=255-r[i];r[i+1]=255-r[i+1];r[i+2]=255-r[i+2]}t.putImageData(n,0,0);return e},cloneCanvas:function(e){var t=document.createElement("canvas");var n=t.getContext("2d");t.width=e.width;t.height=e.height;n.drawImage(e,0,0);return t},drawHomeLink:function(){if(!n.HOME_LINK){var e=new Image;e.onload=function(){var e=document.createElement("canvas");e.width=this.width;e.height=this.height;var t=e.getContext("2d");t.drawImage(this,0,0,this.width,this.height);n.HOME_LINK={light:e,dark:r.invertCanvas(r.cloneCanvas(e))};r.drawHelpArrow()};e.src=t.SRC_HOME_LINK}else{r.drawHelpArrow()}},drawHelpArrow:function(){if(!n.HELP_ARROW){var e=new Image;e.onload=function(){var e=document.createElement("canvas");e.width=this.width;e.height=this.height;var t=e.getContext("2d");t.drawImage(this,0,0,this.width,this.height);n.HELP_ARROW={light:e,dark:r.invertCanvas(r.cloneCanvas(e))};r.drawIconsBig()};e.src=t.SRC_HELP_ARROW}else{r.drawIconsBig()}},drawIconsBig:function(){if(!n.ICONS){var e=new Image;e.onload=function(){var e=document.createElement("canvas");e.width=this.width;e.height=this.height;var t=e.getContext("2d");t.drawImage(this,0,0,this.width,this.height);n.ICONS={light:e,dark:r.invertCanvas(r.cloneCanvas(e))};r.drawIconsMini()};e.src=t.SRC_ICONS_BIG}else{r.drawIconsMini()}},drawIconsMini:function(){if(!n.ICONS_MINI){var i=new Image;i.onload=function(){var t=document.createElement("canvas");t.width=this.width;t.height=this.height;var i=t.getContext("2d");i.drawImage(this,0,0,this.width,this.height);n.ICONS_MINI={light:t,dark:r.invertCanvas(r.cloneCanvas(t))};e&&e()};i.src=t.SRC_ICONS_MINI}else{e&&e()}}};r.drawHomeLink()},getIconsPanelWidth:function(){return this.CFG.ICONS_PANEL[this.PANEL_TYPE].width},getIconsPanelHeight:function(){var e=this.CFG.ICONS_PANEL,t=e[this.PANEL_TYPE].height,n=e[this.PANEL_TYPE].noTitle,r=e.titleSection;return this.NO_ONE_TITLES?t-r+n:t},fsapi:{goFullScreen:function(e){var t=e?document.getElementById(e):document.documentElement,n=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen;n.call(t)},exitFullScreen:function(){var e=document,t=e.exitFullscreen||e.webkitCancelFullScreen||e.webkitExitFullScreen||e.webkitExitFullscreen||e.mozCancelFullScreen||e.msExitFullscreen;t.call(e)},isFullScreen:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement}},buildIconsPanel:function(){var t=this,n=this.CFG.ICONS_PANEL,r=this.STAGE,i=this.CFG.BOOK_SIZE,s=this.divNames.book_icons_panel,o=this.divNames.icons_container,u=this.divNames.book_spread_title,a=!this.DARK_MODE?" light":"";var f={build:function(){if(t.NO_ONE_TITLES){var r=n[l].noTitle;return p=e(['<table cellpadding="0" cellspacing="0" width="100%" align="center" border=0>','<tr><td height="'+r+'px" style="font-size:0;line-height:0;"><img width="1px" height="1px" src="'+t.GIF+'"></td></tr>','<tr><td><div class="'+o+'" style="position:relative;"></div></td></tr>',"</table>"].join(""))}else{var i=t.CFG.ICONS_PANEL.titleSection;return p=e(['<table cellpadding="0" cellspacing="0" width="100%" align="center" border=0>','<tr><td height="'+i+'px" class="'+u+'">&nbsp;</td></tr>','<tr><td><div class="'+o+'" style="position:relative;"></div></td></tr>',"</table>"].join(""))}}};var l=this.PANEL_TYPE;var c=this.getIconsPanelWidth();var h=this.getIconsPanelHeight();if(!l){return}var p=f.build();var d=e("#"+s);d.size()&&d.remove();var d=e('<div id="'+s+'" class="unselectable'+a+'" style="visibility:hidden;"></div>').append(p).css({width:c,height:h});e("body").append(d);this.$gIconsPanel=d;!this.BOOK_INTERNAL&&this.$gIconsPanel.mousewheel&&this.$gIconsPanel.mousewheel(function(){return false});var v=e('<div style="width:1px;display:table-cell;"><img width="'+n[l].betweenIcons+'px" src="'+this.GIF+'"></div>');var m=d.find("."+o);this.$gSpreadTitle=d.find("."+u);var g={skin:function(e){t.$gSaveMenu.hide();if(!t.ZOOM_MODE){t.toggleSkin()}},save:function(e){if(!t.ZOOM_MODE){t.saveImagesAs()}},next:function(e){t.gotoNext()},prev:function(e){t.gotoPrev()},zoom:function(e){t.$gSaveMenu.hide();if(!t.ZOOM_MODE){t.zoomIn()}},close:function(e){t.$gSaveMenu.hide();if(!t.ZOOM_MODE){if(t.fsapi.isFullScreen()){t.fsapi.exitFullScreen();setTimeout(function(){t.exit()},700)}else{t.exit()}}},fullScreen:function(n){t.$gSaveMenu.hide();if(!t.ZOOM_MODE){if(t.BOOK_INTERNAL){var r=e.extend(t.options,{startPage:t.START_PAGE,parentBook:t.PRE_NAME,slope:t.CURRENT.slope_mode});e.onebook(t.IMAGES_SRC,r)}else{if(t.fsapi.isFullScreen()){t.fsapi.exitFullScreen()}else{t.bookHide();t.bgLoaderShow(true);t.fsapi.goFullScreen()}}}},slope:function(e){t.$gSaveMenu.hide();if(!t.ZOOM_MODE){t.slopeAnimate()}},toggleBook:function(e){t.$gSaveMenu.hide();t.toggleBook()}};var y=t.fsapi.isFullScreen()?"fromfullScreen":"tofullScreen";if(l==="tiny"){var b=this.cloneIconsSet();b.find(">div").append(this.buttonCreate("Prev",g.prev)).append(v.clone());b.find(">div").append(this.buttonCreate("Save",g.save)).append(v.clone());b.find(">div").append(this.pageNumbersCreate(l)).append(v.clone());b.find(">div").append(this.buttonCreate("Slope",g.slope)).append(v.clone());b.find(">div").append(this.buttonCreate(y,g.fullScreen)).append(v.clone());b.find(">div").append(this.buttonCreate("Next",g.next));m.append(b);p.css({position:"absolute",zIndex:10,top:0,left:c/2-b.width()/2});this.$gButtonsTitle=d.find(".btn_title")}else if(l==="small"){var w=this.cloneIconsSet();w.find(">div").append(this.buttonCreate("Save",g.save)).append(v.clone());w.find(">div").append(this.pageNumbersCreate(l)).append(v.clone());m.append(w.css({"float":"left"}));var b=this.cloneIconsSet();b.find(">div").append(this.buttonCreate("Prev",g.prev)).append(v.clone());b.find(">div").append(this.buttonCreate("Zoom",g.zoom)).append(v.clone());b.find(">div").append(this.buttonCreate("Next",g.next));m.append(b);b.css({position:"absolute",zIndex:10,top:0,left:c/2-b.width()/2});var E=this.cloneIconsSet();E.find(">div").append(this.buttonCreate("togglebook",g.toggleBook)).append(v.clone());E.find(">div").append(this.buttonCreate("Slope",g.slope)).append(v.clone());E.find(">div").append(this.buttonCreate(y,g.fullScreen));m.append(E.css({"float":"right"}));this.$gButtonsTitle=d.find(".btn_title")}else if(l==="middle"){var w=this.cloneIconsSet();w.find(">div").append(this.buttonCreate("Save",g.save)).append(v.clone());w.find(">div").append(this.buttonCreate("Skin",g.skin)).append(v.clone());w.find(">div").append(this.pageNumbersCreate(l)).append(v.clone());m.append(w.css({"float":"left"}));var b=this.cloneIconsSet();b.find(">div").append(this.buttonCreate("Prev",g.prev)).append(v.clone());b.find(">div").append(this.buttonCreate("Zoom",g.zoom)).append(v.clone());b.find(">div").append(this.buttonCreate("Next",g.next));m.append(b);b.css({position:"absolute",zIndex:10,top:0,left:c/2-b.width()/2});var E=this.cloneIconsSet();E.find(">div").append(this.buttonCreate("togglebook",g.toggleBook)).append(v.clone());E.find(">div").append(this.buttonCreate("Slope",g.slope)).append(v.clone());E.find(">div").append(this.buttonCreate(y,g.fullScreen));E.find(">div").append(v.clone()).append(this.buttonCreate("Close",g.close));m.append(E.css({"float":"right"}));this.$gButtonsTitle=d.find(".btn_title")}else if(l==="large"){var w=this.cloneIconsSet();w.find(">div").append(this.buttonCreate("Save",g.save)).append(v.clone());w.find(">div").append(this.buttonCreate("Skin",g.skin)).append(v.clone());m.append(w.css({"float":"left"}));var b=this.cloneIconsSet();b.find(">div").append(this.buttonCreate("Prev",g.prev)).append(v.clone());b.find(">div").append(this.buttonCreate("Zoom",g.zoom)).append(v.clone());b.find(">div").append(this.buttonCreate("Next",g.next));m.append(b);b.css({position:"absolute",zIndex:10,top:0,left:c/2-b.width()/2});var E=this.cloneIconsSet();E.find(">div").append(this.buttonCreate("togglebook",g.toggleBook)).append(v.clone());E.find(">div").append(this.buttonCreate("Slope",g.slope));if(!t.$TARGET){E.find(">div").append(v.clone()).append(this.buttonCreate("Close",g.close))}m.append(E.css({"float":"right"}));this.$gButtonsTitle=d.find(".btn_title")}this.changeSpreadTitle();this.pageNumbersChange()},toggleBook:function(){if(!this.ZOOM_MODE&&!this.ANIMATION_FLAG){if(this.START_FROM_END){this.START_FROM_END=false;this.CURRENT.spread=0;this.$gHelpLayer.find(".hlpLeftSide").css({opacity:1});this.$gHelpLayer.find(".hlpRightSide").css({opacity:0})}else{this.START_FROM_END=true;this.CURRENT.spread=this.getTotalSheets();this.$gHelpLayer.find(".hlpLeftSide").css({opacity:0});this.$gHelpLayer.find(".hlpRightSide").css({opacity:1})}var e=this.SHEETS_WAS_BUILT;for(var t in e){if(e.hasOwnProperty(t)){this.deleteSheet(t)}}this.START_PAGE=this.CURRENT.spread*2?this.CURRENT.spread*2:1;this.buildAndPreloadSheets();this.changeSpreadTitle();this.pageNumbersChange();this.$G_ARR_BUTTONS["togglebook"]&&this.$G_ARR_BUTTONS["togglebook"].update()}},toggleSkin:function(){var t=this,n=e("#"+this.divNames.book_page_numbers),r=this.DARK_MODE?"light":"dark",s=window[i].SKIN,o=function(){for(var e in t.$G_ARR_BUTTONS){t.$G_ARR_BUTTONS[e].update()}},u=function(){t.$gHelpLayer.find("span[name=home_link]").css({background:"url("+s.HOME_LINK[r].toDataURL()+") no-repeat center"});t.$gHelpLayer.find("span[name=help_arrow]").css({background:"url("+s.HELP_ARROW[r].toDataURL()+") no-repeat center"})};if(this.DARK_MODE){this.DARK_MODE=false;var a=this.getHlpLayerBgImage();this.$gBookBackground.addClass("light");n.addClass("light");this.$gIconsPanel.addClass("light");this.$gHelpLayer.addClass("light");this.$gHelpLayer.find(".hlpLeftSide").css({background:"url("+a+")"});this.$gHelpLayer.find(".hlpRightSide").css({background:"url("+a+")"});u();o()}else{this.DARK_MODE=true;var a=this.getHlpLayerBgImage();this.$gBookBackground.removeClass("light");n.removeClass("light");this.$gIconsPanel.removeClass("light");this.$gHelpLayer.removeClass("light");this.$gHelpLayer.find(".hlpLeftSide").css({background:"url("+a+")"});this.$gHelpLayer.find(".hlpRightSide").css({background:"url("+a+")"});u();o()}},cloneIconsSet:function(){var t=e('<div style="display:table;"><div style="display:table-row"></div></div>');return t.clone()},pageNumbersCreate:function(t){var n=this.divNames.book_page_numbers,r=this.CFG.ICONS_PANEL[t],i=r.pageNumbers.width,s=r.pageNumbers.fontSize,o=!this.DARK_MODE?'class="light" ':"",u=e(['<div id="'+n+'" '+o,'style="display:table-cell;vertical-align:middle;width:'+i+"px;font:"+s+'px arial;">','<span style=""></span></div>'].join(""));return u},pageNumbersChange:function(){var t=this.divNames.book_page_numbers,n=this.CURRENT.spread,r=this.getTotalSheets(),i=n+"&nbsp;/&nbsp;"+r;e("#"+t).find("span").html(i)},buttonCreate:function(t,n,r){this.$G_ARR_BUTTONS=this.$G_ARR_BUTTONS?this.$G_ARR_BUTTONS:[];var s=this,t=t.toLowerCase(),o=r?r.mode:this.DARK_MODE?"dark":"light";if(this.LARGE_ICONS){var u=window[i].SKIN.ICONS,a=this.BTNS_OFFSET,f=this.CFG.ICONS_SIZE.big,l=['<table width="100%" cellpadding="0" cellspacing="0">','<tr><td height="'+f+'px" align="center">','<div class="btn_image" style="width:'+f+"px;height:"+f+'px;" ><img src="'+this.GIF+'"></div>',"</td></tr>",'<tr><td align="center" class="btn_title">-</td></tr></table>'].join("")}else{var u=window[i].SKIN.ICONS_MINI,a=this.BTNS_MINI_OFFSET,f=this.CFG.ICONS_SIZE.small,l=['<div class="btn_image" style="width:'+f+"px;height:"+f+'px;">','<img src="'+this.GIF+'"></div>',"</div>"].join("")}var c=function(){var e=a[t][0],n=e.length>1;if(n){var r=a[t][2],i=s[r]?0:1,o=a[t][0][i],u=a[t][1][i]}else{var o=e,u=t}return{offset:o,lngTitle:s.getLNG(u)}};var h=function(e){var t=s.DARK_MODE?{start:.7,end:1}:{start:.8,end:.5};return t[e]};var p=c(),d="url("+u[o].toDataURL()+") no-repeat "+p.offset+" 0px",v=e('<div class="book_btn" style="width:'+f+'px;display:table-cell;cursor:pointer;">'+l+"</div>"),m=v.clone(),g=m.find(".btn_image").css({background:d,opacity:h("end")}).attr({title:p.lngTitle}),y=m.find(".btn_title").html(p.lngTitle);m.hover(function(){g.css({opacity:h("start")})},function(){g.css({opacity:h("end")})}).mousedown(function(){g.css({backgroundPosition:p.offset+" 1px"})}).mouseup(function(){g.css({backgroundPosition:p.offset+" 0px"});n&&n(t)});m.update=function(){var e=c(),t=s.DARK_MODE?"dark":"light",n="url("+u[t].toDataURL()+") no-repeat "+e.offset+" 0px",r=this.find(".btn_image").css({background:n,opacity:h("end")}).attr({title:e.lngTitle});r=this.find(".btn_title").html(e.lngTitle)};this.$G_ARR_BUTTONS[t]=m;return m},gotoNext:function(){this.$gSaveMenu.hide();if(!this.ZOOM_MODE){if(!this.ANIMATION_FLAG&&!this.startDrag){if(this.isDirectionCorrect("next")){this.animateSheet("next")}}else{this.ORDER_TO_ANIMATE="next"}}},gotoPrev:function(){this.$gSaveMenu.hide();if(!this.ZOOM_MODE){if(!this.ANIMATION_FLAG&&!this.startDrag){if(this.isDirectionCorrect("prev")){this.animateSheet("prev")}}else{this.ORDER_TO_ANIMATE="prev"}}},zoomIn:function(t){var n=this;if(this.ZOOM_MODE||this.ANIMATE_ZOOM){return false}this.ANIMATE_ZOOM=true;this.ZOOM_MODE=1;var r=this.divNames.zoom_layer;var i=e("#"+r);i.size()&&i.remove();this.ZOOMSIZE={height:e(window).height(),width:e(window).width(),top:0,left:0};var s=this.ZOOMSIZE;s.top=e(document).scrollTop();var o=.8;var u={width:s.width*o,height:s.height*o};u.top=Math.floor(s.top+(s.height-u.height)/2);u.left=Math.floor(s.left+(s.width-u.width)/2);var a={buildZoomLayer:function(){var t=e('<div id="'+r+'"></div>').css({border:"1px solid white",position:"absolute",top:u.top,left:u.left,width:u.width,height:u.height,cursor:"pointer",opacity:.5,zIndex:n.CFG.ZINDEX.zoomLayer}).click(function(){if(!n.ANIMATE_ZOOM){n.zoomOut()}});e("body").append(t);n.$gZoomLayer=e("#"+r);a.animateZoomLayerAppear()},animateZoomLayerAppear:function(){var r=s.width;var i=s.height;n.$gZoomLayer.animate({top:s.top,left:s.left,width:r,height:i,opacity:1},200,function(){e(this).css({opacity:0,border:"0px none",background:"#e5e5e5"}).animate({opacity:1},300,function(){n.ANIMATE_ZOOM=false;n.showZoomContent(t)})})}};a.buildZoomLayer()},showZoomContent:function(e){var t=this,e=e,n=this.getTotalSheets(),r=this.CURRENT.spread,i=r==0,s=r==n,o=this.ZOOMSIZE,u=250,a=85,f={width:o.width,height:o.height-a,left:o.left,top:o.top},l=!i&&!s?2:1;var c={height:this.CFG.BOOK_UNSCALED.height,width:this.CFG.BOOK_UNSCALED.width*l};var h=c.width<f.width&&c.height<f.height;var p={vertical:(c.height+u*2-f.height)/100,horizontal:(c.width+u*2-f.width)/100};var d="",v=this.divNames.zoom_content,m=this.divNames.zoom_behavior_section,g=this.divNames.zoom_title_spread,y=this.divNames.zoom_buttons;var b="position:absolute;width:100%;height:"+a+"px;top:"+f.height+"px;left:0px;";var w=['<div class="'+v+'" style="width:100%;height:100%;"></div>','<div style="'+b+'z-index:10;background:white;opacity:0.8">&nbsp;</div>','<div style="'+b+'z-index:30;" class="'+y+'">&nbsp;</div>','<div style="position:absolute;width:100%;height:100%;top:0px;left:0px;z-index:20;">','<table width="100%" height="100%" cellspacing="0" cellpadding="0" border="0">','<tr><td colspan=3 align="center" class="'+m+'"></td></tr>','<tr><td align="center" class="'+g+'">'+this.CURRENT.spreadTitle+"</td></tr>","</table>","</div>"].join("");this.$gZoomLayer.html(w);var E=this.$gZoomLayer.find("."+v);var S=this.$gZoomLayer.find("."+m).css({height:f.height});var x=this.$gZoomLayer.find("."+g).css({height:a});var T=this.$gZoomLayer.find("."+y);var N={buttonsInsert:function(){var e=t.cloneIconsSet();e.append(t.buttonCreate("zoomClose",function(){},{mode:"light"}));T.append(e.css({"float":"right",margin:"8px 8px 0px 0px"}))},calculateCoord:function(e){var t={x:e.x-f.left,y:e.y-f.top};var n={vertical:100/(f.height/t.y),horizontal:100/(f.width/t.x)};var r=p.vertical*n.vertical*-1+u;var i=p.horizontal*n.horizontal*-1+u;return{top:r,left:i}},moveContent:function(e){d.css({marginTop:e.top+"px",marginLeft:e.left+"px"})},contentToCenter:function(){var t=20;var n=parseFloat(d.css("marginLeft"))||0;var r=parseFloat(d.css("marginTop"))||0;if(e&&!h){var i=this.calculateCoord(e);var s=i.left;var o=i.top}else{var s=(c.width-f.width)/2*-1;var o=c.height<f.height?(c.height-f.height)/2*-1:0}N.recurseAnimation(t,0,[n,r],[s,o])},behaviors:function(){var n=this;S.mousemove(function(e){if(!h){N.moveContent(n.calculateCoord({x:e.pageX,y:e.pageY}))}}).hover(function(){if(!h){if(t.TMR_ZOOMPAGES_ANI){clearTimeout(t.TMR_ZOOMPAGES_ANI);t.TMR_ZOOMPAGES_ANI=null}if(e){e=false}else{d.hide().fadeIn("normal")}}},function(){if(e){e=false}N.contentToCenter()})},recurseAnimation:function(e,n,r,i){t.TMR_ZOOMPAGES_ANI=setTimeout(function(){n++;var t=n/e;var s=1-(1-Math.sin(Math.acos(1-t)));var o=s*100;var u=r[1]-(r[1]-i[1])/100*o;var a=r[0]-(r[0]-i[0])/100*o;d.css({margin:u+"px 0px 0px "+a+"px"});if(n<e){N.recurseAnimation(e,n,r,i)}},5)},showEmptyPages:function(){var e=c.height;var t=c.width;var n="";if(!i&&!s){n+='<td class="page_back" width="50%"></td><td class="page_front" width="50%"></td>'}else{n+=i?'<td class="page_front"></td>':'<td class="page_back"></td>'}var r=['<table class="zoom_pages" width="'+t+'px" height="'+e+'px" style="display:none;"><tr>',n,"</tr></table>"].join("");E.html(r);d=E.find(".zoom_pages");N.behaviors();N.insertSelfShadow();N.choosePageForLoading()},insertSelfShadow:function(){var e=t.SELFSHADOW_UNSCALED;var n=d.height();d.find(".page_back").html('<div style="width:100%;height:'+n+"px;background:url("+e["back"].toDataURL()+') no-repeat;">&nbsp;</div>');d.find(".page_front").html('<div style="width:100%;height:'+n+"px;background:url("+e["front"].toDataURL()+') no-repeat;">&nbsp;</div>');d.fadeIn("normal");N.contentToCenter()},insertImageToZoomPage:function(e){var n=e.side=="left"?".page_back":".page_front";var i=e.side=="left"?r-1:r;var s=t.buildResizedImage(t.CFG.BOOK_UNSCALED,1,{img:e.img,page:e.side=="left"?0:1,sheet:i},false);if(t.CFG.DIVIDE_IMAGES){var o=e.side=="left"?0:t.CFG.BOOK_UNSCALED.width*-1;d.find(n).css({background:'url("'+s.toDataURL()+'") '+o+"px 0px no-repeat"})}else{d.find(n).css({background:'url("'+s.toDataURL()+'") no-repeat'})}},loadImageForZoomPage:function(e,n){if(!t.TMR_ZOOM){t.TMR_ZOOM={}}if(e.indexOf(".png")>-1||e.indexOf(".jpg")>-1||e.indexOf(".gif")>-1){var r=new Image;r.onload=function(){var t={img:this,src:e,side:n};setTimeout(function(){N.insertImageToZoomPage(t)},10)};t.IMG_NOW_LOADING_FOR_ZOOM.push(r);r.src=e}},choosePageForLoading:function(){if(!r){var e=0;var i=t.ARR_PAGES_SRC[e];N.loadImageForZoomPage(i,"right")}else if(r==n){var e=n*2-1;var i=t.ARR_PAGES_SRC[e];N.loadImageForZoomPage(i,"left")}else{var e=r*2-1;var i=t.ARR_PAGES_SRC[e];N.loadImageForZoomPage(i,"left");var e=r*2;var i=t.ARR_PAGES_SRC[e];N.loadImageForZoomPage(i,"right")}}};N.buttonsInsert();N.showEmptyPages()},zoomOut:function(){if(!this.ZOOM_MODE){return false}this.ZOOM_MODE=0;this.$gZoomLayer&&this.$gZoomLayer.remove()},slopeAnimate:function(){var e=this;if(this.ANIMATION_SLOPE){return false}this.ANIMATION_SLOPE=true;var t=this.CFG.ARR_SLOPE_ANGLES.length;var n=e.CURRENT.slope_mode;var r=this.CFG.ARR_SLOPE_ANGLES[n];this.CURRENT.slope_mode=n+1<t?n+1:0;this.CFG.START_SLOPE_MODE=this.CURRENT.slope_mode;var i=this.CFG.ARR_SLOPE_ANGLES[this.CURRENT.slope_mode];var s=i>r?1:-1;var o=function(){r+=s;setTimeout(function(){if(r!=i){e.rotate_x_to(r);o()}else{e.rotate_x_to(r);e.ANIMATION_SLOPE=false}},10)};o()},slopeToggle:function(e){var t=this,e=parseInt(e,0),n=this.CFG.ARR_SLOPE_ANGLES;if(e<n.length){var r=n[e];this.CURRENT.slope_mode=e;this.CFG.START_SLOPE_MODE=this.CURRENT.slope_mode;this.rotate_x_to(r)}},rotate_x_to:function(e){var t="translate3d("+this.OFFSET.left+"px,"+this.OFFSET.top+"px,0px) rotateX("+e+"deg)";this.$gContainter.css({"-webkit-transform":t,"-moz-transform":t})},fit3dDataToBookSize:function(){var e=this;this.FRAMES=this.getClonedData();this.FRAMES_UNSCALED=this.getClonedData();var t=!this.$TARGET?this.CFG.SPACE_AROUND_STAGE:{horizontal:0,vertical:0};var n={width:this.FIRST_IMAGE_SIZE.w+2*e.CFG.BORDER||100,height:this.FIRST_IMAGE_SIZE.h+2*e.CFG.BORDER||100};if(this.CFG.DIVIDE_IMAGES){n.width=n.width%2>0?(n.width-1)/2:n.width/2}var r=!this.$TARGET?this.WINSIZE:this.TARGETSIZE;if(this.BOOK_INTERNAL){r.height=this.CFG.MAX_SCREEN_SIZE.height}var i=this.getIconsPanelHeight();var s={w:Math.min(this.CFG.MAX_SCREEN_SIZE.width,r.width)-t.horizontal,h:Math.min(this.CFG.MAX_SCREEN_SIZE.height,r.height)-i-t.vertical};var o={w:2*n.width+2*this.CFG.PASPARTU_BEHAVIORS_PARAM.width,h:n.height+2*this.CFG.PASPARTU_BEHAVIORS_PARAM.height};if(o.w>s.w||o.h>s.h){var u=s.w/o.w;var a=s.h/o.h;var f=Math.min(u,a)}else{var f=1}this.GSCALE=f;bookUnscaled={width:n.width,height:n.height};n.width=Math.round(n.width*this.GSCALE);n.height=Math.round(n.height*this.GSCALE);var l=this.FRAMES[0][0].bezie.length;var c=Math.abs(this.FRAMES[0][0].bezie[l-1].x);var h=n.width/c;var p=bookUnscaled.width/c;var d=function(e,t){for(var n=0;n<e.length;n++){var r=e[n].edges3d;for(var i=0;i<r.length;i++){r[i].width*=t;r[i].x*=t;r[i].z*=t}}};d(this.FRAMES[0],h);d(this.FRAMES[1],h);d(this.FRAMES_UNSCALED[0],p);d(this.FRAMES_UNSCALED[1],p);this.initWithSize(n,bookUnscaled)},saveImagesAs:function(){var t=this;var n=function(e){var t=e.toDataURL().match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),n=atob(t[3]),r=new ArrayBuffer(n.length),i=new Uint8Array(r);for(var s=0;s<i.length;s++){i[s]=n.charCodeAt(s)}return new Blob([i],{type:t[1]})};var r={loadImage:function(e){var t=new Image;t.onload=function(){var e=document.createElement("canvas");e.width=this.width;e.height=this.height;var t=e.getContext("2d");t.drawImage(this,0,0,this.width,this.height);r.saveImage(e)};t.src=e},saveImage:function(e){var t=window.URL||webkitURL;var r=document.createElement("a");var i=n(e);r.download="photo.png";r.href=t.createObjectURL(i);document.body.appendChild(r);r.click();document.body.removeChild(r);setTimeout(function(){t.revokeObjectURL(i)},100)},showMenu:function(){t.$gSaveMenu.toggle()}};var i=this.CURRENT.spread==0,s=this.CURRENT.spread==this.getTotalSheets(),o=this.ARR_PAGES_SRC;if(i){r.loadImage(o[0])}else if(s){r.loadImage(o[o.length-1])}else{t.$gSaveMenu.find("a").unbind().each(function(n){e(this).click(function(){var e=n?t.CURRENT.spread*2:t.CURRENT.spread*2-1;o[e]&&r.loadImage(o[e]);r.showMenu();return false})});r.showMenu()}},initWithSize:function(e,t){var n=this;if(!e.width||!e.height){return false}this.CFG.BOOK_SIZE=e;this.CFG.BOOK_UNSCALED=t;this.MOUSE={startDragCoord:{x:0,y:0},oldCoord:{x:0,y:0},lastCoord:{x:0,y:0},isOverStage:false};this.ANIMATION={SPEED:15};this.STAGE={width:Math.round(this.CFG.BOOK_SIZE.width+this.CFG.PASPARTU_BEHAVIORS_PARAM.width*this.GSCALE)*2,height:Math.round(this.CFG.BOOK_SIZE.height+this.CFG.PASPARTU_BEHAVIORS_PARAM.height*2*this.GSCALE)};this.STAGE_HALF={width:this.STAGE.width/2,height:Math.round(this.STAGE.height/2)};this.STAGE_CENTER={top:0,left:0};this.OFFSET={top:Math.round((this.STAGE.height-this.CFG.BOOK_SIZE.height)*.5),left:this.STAGE.width*.5};this.CURRENT={frame:0,sheet:-1,dragged_sheet:-1,spread:0,hoverframe:0,hoverside:"front",dir_ani:1,slope_mode:this.CFG.START_SLOPE_MODE,spreadTitle:""};this.LAST={mousemoved:false,sheet:-1,forward:1,moved:{sheet:-1,$edges:false,forward:0}};this.$gStage.css({width:this.STAGE.width,height:this.STAGE.height,border:"0px solid none"});this.$gContainter.css({width:this.CFG.BOOK_SIZE.width,height:this.CFG.BOOK_SIZE.height*this.CFG.ROTATE_CENTER_OFFSET,border:"0px solid none"});this.calculateSheets();this.correctStartPage();this.rotate_x_to(this.CFG.ARR_SLOPE_ANGLES[this.CURRENT.slope_mode]);this.SELFSHADOW={front:this.createSelfShadow("front",this.CFG.BOOK_SIZE),back:this.createSelfShadow("back",this.CFG.BOOK_SIZE)};this.SELFSHADOW_UNSCALED={front:this.createSelfShadow("front",this.CFG.BOOK_UNSCALED),back:this.createSelfShadow("back",this.CFG.BOOK_UNSCALED)};this.buildIconsPanel();this.buildSaveMenuLayer();this.buildHelpLayer();this.stageToCenter();this.behavior();this.buildAndPreloadSheets()},correctStartPage:function(){var e=function(e,t,n){if(e<t){e=t}if(e>n){e=n}return e};this.START_PAGE=e(this.START_PAGE,1,this.getTotalSheets()*2);this.CURRENT.spread=(this.START_PAGE-this.START_PAGE%2)/2;this.START_FROM_END=this.CURRENT.spread===this.getTotalSheets()},calculateSheets:function(){if(!this.ALLSHEETS||!this.ALLSHEETS.length){this.ALL_PAGES_MAP=[];var e=[];if(!this.CFG.DIVIDE_IMAGES){var t=this.ARR_PAGES_SRC.length}else{if(this.ARR_PAGES_SRC.length<2){this.ARR_PAGES_SRC.push(this.CFG.PAGE_DEFAULT_COLOR)}var t=this.ARR_PAGES_SRC.length*2;var n=[];n.push(this.ARR_PAGES_SRC[0]);for(var r=1;r<this.ARR_PAGES_SRC.length;r++){n.push(this.ARR_PAGES_SRC[r]);n.push(this.ARR_PAGES_SRC[r])}n.push(this.ARR_PAGES_SRC[0]);this.ARR_PAGES_SRC=n}for(var r=0;r<t;r++){var i=this.ARR_PAGES_SRC[r].indexOf(".jpg")>-1||this.ARR_PAGES_SRC[r].indexOf(".png")>-1||this.ARR_PAGES_SRC[r].indexOf(".gif")>-1;this.ALL_PAGES_MAP[r]=i?"image":"color"}var s=t%2>0?(t+1)/2:t/2;if(t<s*2){this.ARR_PAGES_SRC.push(this.CFG.PAGE_DEFAULT_COLOR)}for(var r=0;r<this.ARR_PAGES_SRC.length;r+=2){e.push({front:this.ARR_PAGES_SRC[r],back:this.ARR_PAGES_SRC[r+1],opened:0})}this.ALLSHEETS=e}},createSelfShadow:function(e,t){var n=this;var r=document.createElement("canvas");r.width=t.width;r.height=t.height;var i=r.getContext("2d");var s=i.createLinearGradient(0,0,r.width,0);if(e=="front"){s.addColorStop(0,"rgba(0,0,0,0.15)");s.addColorStop(.3,"rgba(0,0,0,0)")}else{s.addColorStop(.7,"rgba(255,255,255,0)");s.addColorStop(1,"rgba(255,255,255,0.15)")}i.fillStyle=s;i.fillRect(0,0,r.width,r.height);return r},addCeshNames:function(e){for(var t=0;t<this.ARR_PAGES_SRC.length;t++){var n=this.ARR_PAGES_SRC[t];if(n.indexOf(".png")>-1||n.indexOf(".jpg")>-1||n.indexOf(".gif")>-1){this.ARR_PAGES_SRC[t]+="?cash="+e}}},getClonedData:function(){return e.extend(true,{},{arr:this.FRDATA}).arr},getLNG:function(e){var t=this.LNG[e]||this.LNG[e.toLowerCase()];return t?t[this.CFG.LANGUAGE]:"unknown"},findBookSizeByFirstImage:function(e){var t=this;var n="";for(var r=0;r<this.ARR_PAGES_SRC.length&&n=="";r++){var i=this.ARR_PAGES_SRC[r];if(i.indexOf(".png")>-1||i.indexOf(".jpg")>-1||i.indexOf(".gif")>-1){n=i}}if(n!=""){var s=new Image;s.onload=function(){t.FIRST_IMAGE_SIZE={w:this.width,h:this.height};e&&e()};s.src=n}else{}},isNeedResizeReposInternal:function(){if(this.BOOK_INTERNAL){var e=this.$TARGET;var t={top:0,left:e.offset().left,width:e.width(),height:100};var n=this.TARGETSIZE;this.TARGETSIZE=t;if(t.width!==n.width){return"resize"}else if(t.left!==n.left){return"reposition"}else{return false}}else{return false}},behavior:function(){var t=this;this.startDrag=false;if(!this.HAS_BEHAVIORS){e(window).bind("resize."+this.PRE_NAME,function(){t.zoomOut();if(t.TMR_RESIZE){clearTimeout(t.TMR_RESIZE);t.TMR_RESIZE=null}t.TMR_RESIZE=setTimeout(function(){if(t.BOOK_INTERNAL){if(!window[i].SUPERBOOK){var e=t.isNeedResizeReposInternal();e&&t.restart(e)}}else{t.restart()}},300)});e(document).bind("keyup."+this.PRE_NAME,function(e){if(window[i].CURRENT===t.PRE_NAME){if(e.keyCode===39){t.gotoNext()}else if(e.keyCode===37){t.gotoPrev()}}});this.HAS_BEHAVIORS=true}var n={id:this.PRE_NAME+"canvasZoomWaiter",size:this.CFG.ZOOM_WAITER_SIZE,create:function(){t.$gZoomWaiter=e("#"+t.divNames.zoom_waiter).css({width:this.size,height:this.size});t.$gZoomWaiter.html('<canvas id="'+this.id+'" width="'+this.size+'" height="'+this.size+'"></canvas>');t.gZoomWaiterContext=document.getElementById(this.id)&&document.getElementById(this.id).getContext("2d")}};n.create();var r={size:this.CFG.ZOOM_WAITER_SIZE,radius:25,draw:function(e){var n=this.size;var r=this.radius;var i=function(t){t.clearRect(0,0,n,n);t.beginPath();t.lineWidth=2;t.strokeStyle="#c7c7c7";var i=n/2;var s=(e-90)*Math.PI/180;var o=-1.5707963267948966;t.arc(i,i,r,o,s);t.stroke()};t.gZoomWaiterContext&&i(t.gZoomWaiterContext)},show:function(){var e=t.STAGE_BOUNDING_BOX;var n=t.MOUSE.startDragCoord;t.$gZoomWaiter.css({top:n.y-30-e.top,left:n.x-30-e.left}).show()},hide:function(){t.$gZoomWaiter.hide()}};var s=function(e){var n=0,i,o={time:20,start:5,pause:40},u=360/(o.time-o.start),a=false;(s=function(e){var f={stop_waiting:function(){if(a){a=false;r.hide();if(n){n=0;i&&clearTimeout(i);i=null}}},verify:function(){if(e){this.stop_waiting()}else if(n>o.time-1){this.stop_waiting();t.getSheetByIndex(t.CURRENT.dragged_sheet).find(".wholeimage").show();t.ORDER_TO_ANIMATE=false;t.stop_drag();t.zoomIn(t.MOUSE.startDragCoord)}else{a=true;n++;if(n===o.start+1){r.show()}if(n>o.start){r.draw(u*(n-o.start))}i=setTimeout(function(){s()},o.pause)}}};f.verify()})(e)};var o=e("#"+t.divNames.book_stage);o.unbind();o.hover(function(){t.MOUSE.isOverStage=true},function(){t.MOUSE.isOverStage=false;if(!t.ANIMATION_FLAG){if(t.startDrag){t.stop_drag_and_animate()}}});o.mousedown(function(e){t.LAST.mousemoved=false;if(!t.ZOOM_MODE){if(t.ANIMATION_FLAG||!t.isMouseOverPage()){return false}else{s();t.start_drag(e);return false}}else{return false}});o.mouseup(function(){if(!t.ZOOM_MODE){s("stop");var e=t.CURRENT.hoverside==="front"?"next":"back";if(t.ANIMATION_FLAG){if(!t.LAST.mousemoved){t.ORDER_TO_ANIMATE=e}return false}else{if(t.startDrag){t.stop_drag_and_animate()}}}else{return false}});o.mousemove(function(e){t.MOUSE.oldCoord=t.MOUSE.lastCoord;t.MOUSE.lastCoord={x:e.pageX,y:e.pageY};t.calculateSideAndFrame(t.MOUSE.lastCoord);t.LAST.mousemoved=true;!t.ZOOM_MODE&&s("stop");if(t.ANIMATION_FLAG){return false}if(t.startDrag){var n=Math.abs(t.MOUSE.oldCoord.x-t.MOUSE.lastCoord.x);if(n>t.CFG.MAX_MOUSE_SPEED_X){t.stop_drag_and_animate();return}var r=Math.abs(t.MOUSE.startDragCoord.x-t.MOUSE.lastCoord.x);var i=Math.round(r/t.CFG.DRAG_PARAM.px_per_persent);var o=i+t.START_DRAG_FRAME||0;if(o>t.CFG.MAX_FRAME_DRAGGABLE){t.stop_drag_and_animate();return}t.drag_sheet(o)}});o.mousewheel&&o.mousewheel(function(e,n){if(t.ANIMATION_FLAG||t.startDrag){return false}else{var r=n>0?"gotoPrev":"gotoNext";if(t.clickSpeedIsOk()){t[r]()}return false}})},clickSpeedIsOk:function(){var e=(new Date).getTime();if(!this.G_TMR_SPEED_CLICK){this.G_TMR_SPEED_CLICK=e;return true}else{var t=this.G_TMR_SPEED_CLICK;var n=e-t;if(n>1100){this.G_TMR_SPEED_CLICK=e;return true}else{return false}}},start_drag:function(e){this.MOUSE.startDragCoord={x:e.pageX,y:e.pageY};this.START_DRAG_FRAME=this.CURRENT.frame;this.startDrag=this.CURRENT.hoverside;var t=this.CURRENT.spread;this.CURRENT.dragged_sheet=this.startDrag=="front"?t:t-1},stop_drag_and_animate:function(){var e=this.startDrag=="front"?"gotoNext":"gotoPrev";this.CURRENT.dragged_sheet=-1;this.startDrag=false;this[e]()},stop_drag:function(){this.CURRENT.dragged_sheet=-1;this.startDrag=false},changeSpreadTitle:function(){var e=this.CURRENT.spread;var t=this.ARR_PAGES_TITLE.length;var n={left:"",right:""};var r="";if(e===0){var i=true;n.right=this.ARR_PAGES_TITLE[0]}else if(e*2-1==t){var s=true;n.left=this.ARR_PAGES_TITLE[e*2-1]}else{n.left=this.ARR_PAGES_TITLE[e*2-1];n.right=this.ARR_PAGES_TITLE[e*2]}if(i){r="<p>"+n.right+"</p>"}else if(s){r="<p>"+n.left+"</p>"}else{var o=this.getLNG("left");var u=this.getLNG("right");if(n.left&&n.right){r=["<p><span>"+o+":</span> "+n.left+"<br>","<span>"+u+":</span> "+n.right+"</p>"].join("")}else if(n.left){r="<p><span>"+o+":</span> "+n.left+"</p>"}else if(n.right){r="<p><span>"+u+":</span> "+n.right+"</p>"}}this.CURRENT.spreadTitle=r;this.$gSpreadTitle.html(r)},calculateBounds:function(){var t=this,n=t.CFG.ICONS_PANEL,r=t.getIconsPanelHeight(),i=t.STAGE,s=!t.$TARGET?t.WINSIZE:t.TARGETSIZE,o=!t.$TARGET?{top:0,left:0}:{top:t.$TARGET.offset().top,left:t.$TARGET.offset().left},u=t.CFG.PASPARTU_BEHAVIORS_PARAM.height*t.GSCALE,a=u*n.overlay_pr,f=Math.round((s.height-(i.height+r-a))*.5);f=!t.BOOK_INTERNAL?f+e(document).scrollTop():0;this.STAGE_OFFSET=offset={left:Math.round(s.width*.5-i.width*.5)+o.left,top:f+o.top};this.STAGE_CENTER={top:Math.round(offset.top+i.height*.5),left:Math.round(offset.left+i.width*.5)};this.STAGE_BOUNDING_BOX={width:i.width,height:i.height,top:offset.top,left:offset.left};var l=this.$gIconsPanel.width();this.ICONS_PANEL_BOUNDS=ipb={width:l,height:this.$gIconsPanel.height(),left:s.width*.5-l*.5+o.left,top:offset.top+t.STAGE.height-a};this.MAX_BOUNDS={width:Math.max(t.STAGE_BOUNDING_BOX.width,ipb.width),height:Math.round(ipb.top+ipb.height-t.STAGE_BOUNDING_BOX.top),top:t.STAGE_BOUNDING_BOX.top,left:Math.min(t.STAGE_BOUNDING_BOX.left,ipb.left)}},stageToCenter:function(){var e=this;if(!this.STAGE){return}if(this.tmrToCenter){clearTimeout(this.tmrToCenter)}this.$gStage.hide();this.tmrToCenter=setTimeout(function(){e.calculateBounds();e.$gStage.css({top:e.STAGE_OFFSET.top,left:e.STAGE_OFFSET.left}).show();e.bgLoaderShow(false);var t=e.ICONS_PANEL_BOUNDS,n={width:e.$gBookLoader.width(),height:e.$gBookLoader.height()},r={width:e.$gSaveMenu.width(),height:e.$gSaveMenu.height()},i=e.STAGE;e.$gIconsPanel.css({top:t.top,left:t.left,visibility:"visible"});e.$gBookLoader.css({top:i.height*.5-n.height*.5,left:i.width*.5-n.width*.5});e.$gSaveMenu.css({top:i.height*.5-r.height*.5+e.STAGE_OFFSET.top,left:i.width*.5-r.width*.5+e.STAGE_OFFSET.left});e.correctTargetHeight()},100)},correctTargetHeight:function(){if(this.BOOK_INTERNAL){this.$TARGET.css({height:this.MAX_BOUNDS.height})}window[i].buildNextBook()},drag_sheet:function(e){var e=e<100?e:100,t=this.CURRENT.dragged_sheet,n=this.getSheetByIndex(t),r=this.getEdgesFormSheet(t),i=this.startDrag=="front"?1:0,s={sheet:t,$edges:r,forward:i};if(this.SHEET_DISPLAYED===null){this.SHEET_DISPLAYED=t;n.find(".all_edges").show();n.find(".wholeimage").hide()}this.moveSheetTo(e,s)},moveSheetTo:function(e,t,n){var r=this,e=e||0,i=t.sheet,s=t.$edges,o=t.forward,u=2,a=this.FRAMES[o][e].edges3d,f=this.$gHelpLayer.find(".hlpLeftSide"),l=this.$gHelpLayer.find(".hlpRightSide"),c=this.getTotalSheets();if(s&&s.size()){if(r.startDrag&&!i&&o){f.css({opacity:(100-e)/100})}else if(r.startDrag&&i===c-1&&!o){l.css({opacity:(100-e)/100})}this.CURRENT.frame=e;for(var h=0;h<a.length;h++){var p=a[h].width+u;s.eq(h).css({width:p+"px","-webkit-transform":"translate3d("+a[h].x+"px,0px,"+ -a[h].z+"px) rotateY("+a[h].angle+"deg)","-moz-transform":"translate3d("+a[h].x+"px,0px,"+ -a[h].z+"px) rotateY("+a[h].angle+"deg)"})}this.LAST.moved={sheet:i,$edges:s,forward:o}}},calculateSideAndFrame:function(e){try{var t=e.y-this.STAGE_CENTER.top;var n=Math.abs(t);var r=e.x-this.STAGE_CENTER.left;var i=this.STAGE_HALF.width-this.CFG.BOOK_SIZE.width;var s=this.CFG.BOOK_SIZE.width+Math.floor(i*.8);var o=this.STAGE_HALF.width-s;var u=o/100;var a=Math.abs(r);var f={x:Math.round(a/this.CFG.BOOK_SIZE.width*100),y:Math.round(100-n/this.STAGE_HALF.height*100)};if(t<0){f.y=f.y>50?100:f.y*2}if(a>s){f.x=Math.floor((this.STAGE_HALF.width-(a-1))/u)}if(f.x>100){f.x=100}var l=Math.round((f.x*.8+20)/100*f.y);this.CURRENT.hoverside=r<0?"back":"front";this.CURRENT.hoverframe=Math.round(this.CFG.SHEETS_SENSIVITY/100*l);this.LAST.sheet=this.CURRENT.sheet;this.CURRENT.sheet=this.CURRENT.hoverside==="front"?this.CURRENT.spread:this.CURRENT.spread-1}catch(c){}},getEdgesFormSheet:function(e){var t=this.$ARR_SHEETS[e];if(t&&t.size()){t.css({zIndex:2e4});return t.find("div")}else{return false}},getSheetByIndex:function(e){return this.$ARR_SHEETS[e]},isMouseOverPage:function(){if(!this.MOUSE.isOverStage){return false}var e=this.CURRENT.spread==0;var t=this.CURRENT.spread==this.getTotalSheets();if(!e&&!t){return true}else if(e&&this.CURRENT.hoverside=="front"){return true}else if(t&&this.CURRENT.hoverside=="back"){return true}else{return false}},isDirectionCorrect:function(e){var t=e==="next"?1:0,n=this.ALLSHEETS.length;if(this.CURRENT.spread===0&&!t){return false}else if(this.CURRENT.spread===n&&t){return false}else{return true}},startOffsetDepth:function(t,n){var r=this.getSheetByIndex(n),i=this.$gContainter.find(".side-left"),s=this.$gContainter.find(".side-right");if(t){s.eq(0).css({"-webkit-transform":"translate3d(0px,0px,1px)","-moz-transform":"translate3d(0px,0px,1px)"});s.each(function(t){if(t){e(this).css({"-webkit-transform":"translate3d(0px,0px,"+(t-1)*-1+"px)","-moz-transform":"translate3d(0px,0px,"+(t-1)*-1+"px)"})}})}else{var o=i.size(),u=1;if(o){for(var a=o;a>0;a--){i.eq(a-1).css({"-webkit-transform":"translate3d(0px,0px,"+u+"px)","-moz-transform":"translate3d(0px,0px,"+u+"px)"});u-=1}}}},endOffsetDepth:function(e,t){var n=this.getSheetByIndex(t),r=this.$gContainter.find(".side-left"),i=this.$gContainter.find(".side-right");if(e){var s=r.size();if(s){for(var o=s;o>0;o--){r.eq(s-o).css({"-webkit-transform":"translate3d(0px,0px,"+o*-1+"px)","-moz-transform":"translate3d(0px,0px,"+o*-1+"px)"})}}i.eq(0).css({"-webkit-transform":"translate3d(0px,0px,0px)","-moz-transform":"translate3d(0px,0px,0px)"})}else{var s=i.size(),u=s*-1;if(s){for(var o=s;o>0;o--){i.eq(o-1).css({"-webkit-transform":"translate3d(0px,0px,"+u+"px)","-moz-transform":"translate3d(0px,0px,"+u+"px)"});u+=1}}r.last().css({"-webkit-transform":"translate3d(0px,0px,0px)","-moz-transform":"translate3d(0px,0px,0px)"})}},animateSheet:function(e){if(!this.isDirectionCorrect(e)){return}var t=this,n=e==="next"?this.CURRENT.spread:this.CURRENT.spread-1,r=this.getSheetByIndex(n),i=e==="next"?1:0;var s=function(){var e=u+1;var t=100-e;var n=t%o;t=n?t-n:t;var r=100-t;return r};this.SHEET_DISPLAYED=n;this.ANIMATION_FLAG=true;var o=4,u=this.CURRENT.frame,a=i?this.CURRENT.spread:this.CURRENT.spread-1,f=this.ANIMATION.SPEED,l=this.getTotalSheets();this.startOffsetDepth(i,a);var c=s();var h=t.getEdgesFormSheet(a);var p={sheet:a,$edges:h,forward:i};var d=this.CURRENT.spread===0&i,v=this.CURRENT.spread===1&!i,m=this.CURRENT.spread===l&!i,g=this.CURRENT.spread===l-1&i,y=this.$gHelpLayer.find(".hlpLeftSide"),b=this.$gHelpLayer.find(".hlpRightSide");var w=function(){if(c<101){t.moveSheetTo(c,p);if(d){y.css({opacity:(100-c)/100})}if(v){y.css({opacity:c/100})}if(m){b.css({opacity:(100-c)/100})}if(g){b.css({opacity:c/100})}setTimeout(function(){c+=o;w()},f)}else{t.endOffsetDepth(i,a);t.switchCurrents(p)}};r.find(".all_edges").fadeIn("fast",function(){r.find(".wholeimage").hide();w()})},switchCurrents:function(e){var t=this,n=e.sheet,r=e.forward,i=r?(n+1)*10:(this.ALLSHEETS.length-n)*10,s=this.CURRENT.spread;this.LAST.forward=r;this.LAST.moved.forward=r?0:1;var o=!r?0:180,u=this.getSheetByIndex(n),a=u.find(".wholeimage"),f=u.find(".all_edges");u.css({zIndex:i}).toggleClass("side-right").toggleClass("side-left");a.css({"-webkit-transform":"rotateY("+o+"deg)","-moz-transform":"rotateY("+o+"deg)"});this.CURRENT.spread+=r?1:-1;this.CURRENT.frame=0;this.START_PAGE=t.CURRENT.spread*2?t.CURRENT.spread*2:1;this.bookLoaderShow(!this.didSpreadLoaded(n));this.buildAndPreloadSheets();this.changeSpreadTitle();this.pageNumbersChange();var l=this.ORDER_TO_ANIMATE;if(l&&this.isDirectionCorrect(l)){a.fadeIn("fast",function(){t.SHEET_DISPLAYED=null;f.hide();t.ORDER_TO_ANIMATE=false;t.animateSheet(l)})}else{a.fadeIn("fast",function(){t.SHEET_DISPLAYED=null;f.hide();t.ORDER_TO_ANIMATE=false;t.ANIMATION_FLAG=false;var e=t.CURRENT.spread===t.getTotalSheets();var n=t.$G_ARR_BUTTONS["togglebook"];if(e){t.START_FROM_END=true;n&&n.update()}else if(t.CURRENT.spread===0){t.START_FROM_END=false;n&&n.update()}})}},didSpreadLoaded:function(e){var t=this.CURRENT.spread>0?this.$gContainter.find(".sheet"+(this.CURRENT.spread-1)):false;var n=this.CURRENT.spread<this.ALLSHEETS.length?this.$gContainter.find(".sheet"+this.CURRENT.spread):false;if(t){var r=t.hasClass("back-filled")?true:false;if(!r){return false}}if(n){var i=n.hasClass("front-filled")?true:false;if(!i){return false}}return true},build_background:function(){var t=this.divNames.background;var n=e("#"+t);n.size()&&n.remove();var r=!this.DARK_MODE?'class="light"':"";var i=['<div style="opacity:1" id="'+t+'" '+r+" >",'<div style="text-align:center;color:gray;width:100%;height:100%;display:table;">','<span style="vertical-align:middle;display:table-cell;">','<div style="margin:auto;width:90px;height:90px;-moz-border-radius:15px;border-radius:15px;opacity:0.5;',"background:white url("+this.AJAX_LOADER+') center no-repeat;"></div>',"</span></div></div>"].join("");e("body").append(i);this.$gBookBackground=e("#"+t);this.$gBookBackground.mousewheel&&this.$gBookBackground.mousewheel(function(){return false});this.bgLoaderShow(true)},buildSaveMenuLayer:function(){this.$gSaveMenu&&this.$gSaveMenu.remove();var t=this,n=this.divNames.save_menu,r=230,i=this.STAGE.width*.5,i=i<r?r:i,s=i<300?'class="middleSize"':"",o=this.CFG.ZINDEX.bookSaveMenu;var u=function(){var e=document.createElement("canvas");e.width=2;e.height=2;var t=e.getContext("2d");t.fillStyle="rgba(80,80,80,.8)";t.fillRect(0,0,2,2);return e.toDataURL()};var a=['<div class="'+n+'" ','style="display:none;position:absolute;top:0px;left:0px;width:'+i+"px;z-index:"+o+";","text-align:center;background:url("+u()+');-moz-border-radius:7px;border-radius:7px;">','<h1 style="margin:20px 20px 10px 20px;">'+t.getLNG("askSaveImage")+"</h1>",'<p style="margin:0px 20px 20px 20px;">'+t.getLNG("askSaveLinks")+"</p>","</div>"].join("");this.$gSaveMenu=e(a);e("body").append(this.$gSaveMenu)},buildHelpLayer:function(){var t=this,n=this.CFG.BOOK_SIZE,r=this.getLNG("hlpGoToHomelink"),s=this.getLNG("hlpClickToOpen"),o=this.getLNG("hlpUseMousewheel"),u=this.getLNG("toStart"),a=n.width<150?'class="middleSize"':"",f=n.height<130,l=this.DARK_MODE?"dark":"light",c=window[i].SKIN;var h=[];h.push("<p "+a+">");if(!f){h.push('<a style="display:table;margin:0px 0px 0px auto;" href="'+this.CFG.HOME_LINK+'" target="_blank" title="'+r+'"><span name="home_link" style="background:url('+c.HOME_LINK[l].toDataURL()+') no-repeat center;"></span></a>')}h.push('<span name="click_to_open"><a href="#">'+s+"</a></span>");h.push('<span name="use_mousewheel">'+o+"</span>");if(!f){h.push('<span name="help_arrow" style="background:url('+c.HELP_ARROW[l].toDataURL()+') no-repeat center;"></span>')}h.push("</p>");h=h.join("");var p=[];p.push("<p "+a+">");p.push('<span name="goto_start"><a href="#">'+u+"</a></span>");p.push("</p>");p=p.join("");var d=this.START_PAGE<2?1:0;var v=this.START_FROM_END?1:0;var m=this.getHlpLayerBgImage();var g=['<div style="margin-top:1px;display:table;width:100%;height:100%;">','<div class="hlpLeftSide" style="opacity:'+d+";","background:url("+m+");",'display:table-cell;height:100%;width:50%;text-align:right;vertical-align:bottom;">'+h+"</div>",'<div class="hlpRightSide" style="opacity:'+v+";","background:url("+m+");",'display:table-cell;height:100%;width:50%;text-align:right;vertical-align:bottom;">'+p+"</div>","</div>"].join("");var y=this.DARK_MODE?"":'class="light"';this.$gHelpLayer=e("<div "+y+' id="'+this.divNames.book_help_layer+'"></div>').css({top:0,left:n.width*-1+"px",width:n.width*2-2+"px",height:n.height-1+"px"}).html(g).find("span[name=click_to_open]").click(function(){t.gotoNext();return false}).end().find("span[name=goto_start]").click(function(){t.gotoSpread(0);return false}).end();this.$gContainter.html(this.$gHelpLayer)},getHlpLayerBgImage:function(){var e=document.createElement("canvas");e.width=10;e.height=10;var t=e.getContext("2d");t.fillStyle=this.DARK_MODE?"rgba(0,0,0,0.2)":"rgba(255,255,255,0.2)";t.fillRect(0,0,e.width,e.height);return e.toDataURL()},buildAndPreloadSheets:function(){var t=this;var n={buildColorSheet:function(n,r,s){var o=0,u=s===f||s>f?1:0,a=t.FRAMES[u][o].edges3d,l=e('<span class="all_edges" style="display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;"></span>');for(var c=0;c<a.length;c++){var h=a[c].width+i;var p="translate3d("+a[c].x+"px, 0px, "+ -a[c].z+"px) rotateY("+a[c].angle+"deg)";var d="-webkit-transform:rotateY(-180deg);-moz-transform:rotateY(-180deg);";var v='<span class="back" style="background:'+r.back+";"+d+'"></span>';var m='<span class="front" style="background:'+r.front+';"></span>';var g=e('<div class="unselectable frame'+o+"-"+c+'">'+v+m+"</div>").css({position:"absolute",top:"0px",left:"0px",width:h+"px",height:t.CFG.BOOK_SIZE.height+"px","-webkit-transform":p,"-moz-transform":p});l.append(g)}n.html(l);var y=['<span class="back_image" style="-webkit-transform:rotateY(-180deg);-moz-transform:rotateY(-180deg);"><div style=""></div></span>','<span class="front_image" style=""><div style=""></div></span>'].join("");var b=u?0:180;var w=t.CFG.BOOK_SIZE;n.append(['<span class="wholeimage" style="display:block;position:absolute;top:0;left:0;z-index:20;width:'+w.width+"px;height:"+w.height+"px;","-webkit-transform:translate3d(0px,0px,0px) rotateY("+b+"deg);-moz-transform:translate3d(0px,0px,0px) rotateY("+b+'deg);">'+y+"</span>"].join(""))},fillSheetWithDefaultImages:function(e){var n=[t.ALLSHEETS[e].front,t.ALLSHEETS[e].back];for(var r=0;r<n.length;r++){var i=n[r];if(i.indexOf(".png")>-1||i.indexOf(".jpg")>-1||i.indexOf(".gif")>-1){t.createImageFromColor(t.CFG.PAGE_DEFAULT_COLOR,e,r)}else{t.createImageFromColor(i,e,r)}}},startLoadImagesForSheet:function(e){var n=[t.ALLSHEETS[e].front,t.ALLSHEETS[e].back];for(var r=0;r<n.length;r++){var i=n[r];if(i.indexOf(".png")>-1||i.indexOf(".jpg")>-1||i.indexOf(".gif")>-1){t.loadImageForPage(i,e,r)}}}};var r=function(r){if(!t.SHEETS_WAS_BUILT[r]){t.SHEETS_WAS_BUILT[r]=true;var i=r===f||r>f,s=i?(t.ALLSHEETS.length-r)*10:(r+1)*10,o=i?"side-right":"side-left",u=i?"right":"left",a=p[u]*-1;var l=e(['<div  num="'+r+'" class="sheet'+r+" "+o+'" ','style="-webkit-transform:translate3d(0px,0px,'+a+"px);-moz-transform:translate3d(0px,0px,"+a+"px);","position:absolute;top:0;left:0;z-index:"+s+'"></div>'].join(""));if(i){t.$gContainter.append(l)}else{t.$gHelpLayer.after(l)}p[u]+=1;t.$ARR_SHEETS[r]=l;var c=t.getColorsBySheet(r);n.buildColorSheet(l,c,r);n.fillSheetWithDefaultImages(r);n.startLoadImagesForSheet(r)}};var i=1.2,s=this.LAST.forward,o=this.GIF,u=this.CFG.NUMBEROF_PRELOAD_SHEETS,a=this.ALLSHEETS.length,f=this.CURRENT.spread,l=f==a,c=f-u,h=f+u,p={left:this.$gContainter.find(".side-left").size(),right:this.$gContainter.find(".side-right").size()};if(l){c--}c=c<0?0:c;h=h<a?h:a-1;var d=function(){var e=[],t=[];for(var n=c;n<h+1;n++){if(n===f||n>f){t.push(n)}else{e.push(n)}}return e.reverse().concat(t)};var v=d();for(var m=0;m<v.length;m++){r(v[m])}this.deleteSheet(s?c-1:h+1)},deleteSheet:function(e){if(e<0||e>this.ALLSHEETS.length-1||!this.SHEETS_WAS_BUILT[e]){return false}this.SHEETS_WAS_BUILT[e]=false;if(this.IMG_NOW_LOADING[e*2]){this.IMG_NOW_LOADING[e*2].src=this.GIF;this.IMG_NOW_LOADING[e*2].onload=false}if(this.IMG_NOW_LOADING[e*2+1]){this.IMG_NOW_LOADING[e*2+1].src=this.GIF;this.IMG_NOW_LOADING[e*2+1].onload=false}this.$gContainter.find("div.sheet"+e).remove()},getColorsBySheet:function(e){var t=this.CFG.PAGE_DEFAULT_COLOR;var n=this.ALLSHEETS[e].front;n=n.indexOf(".")>-1?t:n;var r=this.ALLSHEETS[e].back;r=r.indexOf(".")>-1?t:r;var i={front:n,back:r};return i},createImageFromColor:function(e,t,n){var r=this;var i=function(){var e=document.createElement("canvas");var t=r.CFG.BOOK_SIZE.width,n=r.CFG.BOOK_SIZE.height;e.width=!r.CFG.DIVIDE_IMAGES?t:t*2;e.height=n;var i=e.getContext("2d");i.fillStyle="rgba(0,0,0,0)";i.fillRect(0,0,e.width,e.height);return e};this.shredAndFill({img:i(),src:e,sheet:t,page:n})},loadImageForPage:function(e,t,n){var r=this;var i=t*2+n;this.NOW_LOADING_COUNTER++;this.IMG_NOW_LOADING[i]=new Image;this.IMG_NOW_LOADING[i].onload=function(){r.NOW_LOADING_COUNTER--;r.update_queue_loaded_images({img:this,src:e,sheet:t,page:n})};setTimeout(function(){r.IMG_NOW_LOADING[i].src=e},500)},update_queue_loaded_images:function(e){var t=this;var n=function(){if(!t.ANIMATION_FLAG){var e=t.QUEUE_IMAGES_LOADED.shift();if(e){t.shredAndFill(e)}}if(t.QUEUE_IMAGES_LOADED.length){t.TMR_QUEUE=setTimeout(function(){n()},10)}};if(this.TMR_QUEUE){clearTimeout(this.TMR_QUEUE)}this.QUEUE_IMAGES_LOADED.push(e);n()},buildResizedImage:function(e,t,n,r){var i=n.img;var s=n.page>0?"back":"front";var o=this.getColorsBySheet(n.sheet);var u=document.createElement("canvas");var a=e.width;var f=e.height;a=!this.CFG.DIVIDE_IMAGES?a:a*2;u.width=a;u.height=f;var l=u.getContext("2d");l.fillStyle=o[s];l.fillRect(0,0,a,f);var c=this.CFG.BORDER*t;var h=u.width-2*c;var p=u.height-2*c;if(i.width>h||i.height>p){var d=h/i.width;var v=p/i.height;var m=Math.min(d,v);var g=d==m;var y=g?h:Math.floor(i.width*m);var b=!g?p:Math.floor(i.height*m)}else{var y=i.width,b=i.height}l.drawImage(i,c,c,y,b);var w=this.getTotalSheets(),E=n.sheet===0&&n.page===0,S=n.sheet===w-1&&n.page===1;if(r){var x=this.SELFSHADOW[s];if(!this.CFG.DIVIDE_IMAGES){if(!E&&!S){l.drawImage(x,0,0)}}else{l.drawImage(x,n.page>0?0:this.CFG.BOOK_SIZE.width,0)}}return u},shredAndFill:function(t){var n=this;if(!this.CFG.BOOK_SIZE.width||!this.CFG.BOOK_SIZE.height){return false}var r={switchSheetLoadingStatus:function(){var e=a*2+u;var t=n.ALL_PAGES_MAP[e]==="color";if(l.hasClass(f+"-loading")){l.removeClass(f+"-loading").addClass(f+"-filled")}else{if(t){l.addClass(f+"-filled")}else{l.addClass(f+"-loading")}}},cutImagesAndInsertIntoEdges:function(t){var r=0,o=t.height,u=t.width,a,c,h;for(var p=0;p<i.length;p++){c=Math.round(i[p].width);if(!n.CFG.DIVIDE_IMAGES){if(f==="front"){a=r;r+=c;h=a+c>u?u-a:c}else{r+=c;a=u-r;h=c;if(a<0){h=c+a;a=0}}}else{}var d=document.createElement("canvas");d.width=h;d.height=o;d.getContext("2d").drawImage(t,a,0,h,o,0,0,h,o);var v=d.toDataURL();var m=document.createElement("img");m.src=v;s.push(m)}var g=l.find(".wholeimage ."+f+"_image"),y=g.find("div"),b=l.find("."+f),w=f==="back"?-1:1;y.css({background:"url("+t.toDataURL()+") "+w+"px 0px no-repeat"});g.css({background:"url("+t.toDataURL()+") 0px 0px no-repeat"});b.each(function(t){e(this).css({background:"url("+s[t].src+") no-repeat",backgroundSize:"100% 100%"})})}};var i=n.FRAMES[0][this.FIRST_FRAME].edges3d;var s=[];var o=t.img;var u=t.page;var a=t.sheet;var f=u>0?"back":"front";var l=this.$ARR_SHEETS[a];r.switchSheetLoadingStatus();var c=this.buildResizedImage(this.CFG.BOOK_SIZE,this.GSCALE,t,"selfShadow");r.cutImagesAndInsertIntoEdges(c);this.bookLoaderShow(!this.didSpreadLoaded(this.CURRENT.spread))}};var o={init:function(e){this.MATH=u.init();this.onReady=e.onReady;this.ARR_ANIMATIONS=[];this.CURRENT_FLIP_NAME=e.flip||"";this.FLIP_NAMES=[];this.CURRENT_KEYFRAME=1;this.CURRENT_LINE=0;this.CFG={SPEED_ANIMATION:15,BOOK_HEIGHT:300,YSCALETOP:.3,YSCALE:.08,BEZIE_ROUGH:4,BOOK_ROTATE_X:0,ARR_BOOK_WIDTH:[]};this.ARR_ANI=['<div id="animations" style="display:none;">','<div class="book" name="basic">','<div class="points" xy="-40,0 -60,0 -80,0 -80,0 -120,0"></div>','<div class="frame" fr="0" ang="0 0 0 0 0"></div>','<div class="frame" fr="30" ang="100 15 5 5 -30"></div>','<div class="frame" fr="60" ang="140 120 40 40 -30"></div>','<div class="frame" fr="80" ang="130 145 195 195 190"></div>','<div class="frame" fr="100" ang="180 180 180 180 180"></div>',"</div>",'<div class="book" name="soft">','<div class="points" xy="-40,0 -60,0 -80,0 -80,0 -120,0"></div>','<div class="frame" fr="0" ang="0 0 0 0 0"></div>','<div class="frame" fr="30" ang="95 60 10 10 -50"></div>','<div class="frame" fr="60" ang="150 145 60 60 -30"></div>','<div class="frame" fr="80" ang="175 170 105 105 60"></div>','<div class="frame" fr="100" ang="180 180 180 180 180"></div>',"</div>",'<div class="book" name="wind">','<div class="points" xy="-40,0 -60,0 -80,0 -80,0 -120,0"></div>','<div class="frame" fr="0" ang="0 0 0 0 0"></div>','<div class="frame" fr="25" ang="110 50 5 5 -50"></div>','<div class="frame" fr="60" ang="140 120 20 20 -50"></div>','<div class="frame" fr="80" ang="130 145 195 195 190"></div>','<div class="frame" fr="100" ang="180 180 180 180 180"></div>',"</div>"].join("");this.load_animations_from_html()},load_animations_from_html:function(){var t=this;var n=function(e){var t=0;for(var n=0;n<e.length;n++){t+=e[n][0]}t=t<0?t*-1:t;return t};e(this.ARR_ANI).find(".book").each(function(){var r=[];var i=e(this).attr("name");var s=e(this).find(".points").attr("xy").split(" ").map(function(e){return e.split(",").map(function(e){return parseInt(e)})});e(this).find(".frame").each(function(t){var n=parseInt(e(this).attr("fr"),10);var i=e(this).attr("ang").split(" ").map(function(e){return parseInt(e)});var o={frame:n,line:[]};for(var u=0;u<s.length;u++){o.line[u]={xy:s[u],ang:i[u],center:[0,0]}}r.push(o)});t.CFG.ARR_BOOK_WIDTH.push(n(s));t.FLIP_NAMES.push(i);t.ARR_ANIMATIONS[i]=r});this.CURRENT_FLIP_NAME=e.inArray(this.CURRENT_FLIP_NAME,this.FLIP_NAMES)!==-1?this.CURRENT_FLIP_NAME:this.FLIP_NAMES[0];var r=window[i].FLIPS[this.CURRENT_FLIP_NAME];r?this.onReady(r):this.rebuild()},rebuild:function(){var e=this.ARR_ANIMATIONS[this.CURRENT_FLIP_NAME];this.FIRST_KEYFRAME=e[0].frame;var t=this.buildAllFramesFrom(e);this.ALL_FRAMES=this.calculateCenters(t);this.calculateBezie();this.calculateEdgeSkewY();this.CFG.AMOUNT_ADGES_3D=this.ALL_FRAMES[0].edges3d.length;var n=[];for(var r=0;r<this.ALL_FRAMES.length;r++){var s=this.ALL_FRAMES[r];var o=[];for(var u=0;u<s.edges3d.length;u++){o[u]={angle:180-s.edges3d[u].angle,width:s.edges3d[u].width,x:s.edges3d[u].x*-1,z:s.edges3d[u].z}}n.push({bezie:s.bezie,edges3d:o,frame:s.frame,keyframe:s.keyframe,line:s.line,skewYbottom:s.skewYbottom,skewYtop:s.skewYtop})}var a=[this.ALL_FRAMES,n];window[i].FLIPS[this.CURRENT_FLIP_NAME]=a;this.onReady(a)},buildAllFramesFrom:function(t){var t=t;var n=[];if(t.length<1)return[];for(var r=0;r<t.length;r++){n[t[r].frame]=e.extend(true,{},t[r]);n[t[r].frame].keyframe=true}for(var r=1;r<t.length;r++){var i=t[r-1];var s=t[r];var o=s.frame-i.frame;for(var u=1;u<o;u++){var a=i.frame+u;var f=[];for(var l=0;l<s.line.length;l++){var c=Math.floor((s.line[l].ang-i.line[l].ang)/o*u+i.line[l].ang);var h=[s.line[l].xy[0],s.line[l].xy[1]];f.push({xy:h,ang:c,center:[0,0]})}n[a]={frame:a,line:f}}}return n},calculateCenters:function(t){var n=this;var t=t;e.each(t,function(e){if(e<n.FIRST_KEYFRAME){return}var t=this.line;for(var e=0;e<t.length;e++){var r=t[e].ang;var i=r>0?1:-1;var s=r*i;var o=t[e].center;var u=[n.MATH.COS[s],i*-n.MATH.SIN[s],o[0],i*n.MATH.SIN[s],n.MATH.COS[s],o[1]];var a=t[e].xy;var f=n.MATH.xy_matrix2d(a,u);t[e].xy=f;if(t[e+1]){t[e+1].center=f}}});return t},calculateBezie:function(){var t=this;var n=this.ALL_FRAMES;var r=this.CFG.BEZIE_ROUGH;e.each(n,function(e){var t=this.line;if(t.length<3){return}var n=[{x:0,y:0}],i=0,s=0,o=0,u=[0,0],a=t[0].xy,f=t[1].xy,l=t[2].xy;for(var c=1;c<r;c++){i=1/r*c;s=(1-i)*(1-i)*(1-i)*u[0]+3*i*(1-i)*(1-i)*a[0]+3*i*i*(1-i)*f[0]+i*i*i*l[0];o=(1-i)*(1-i)*(1-i)*u[1]+3*i*(1-i)*(1-i)*a[1]+3*i*i*(1-i)*f[1]+i*i*i*l[1];n.push({x:s,y:o})}n.push({x:l[0],y:l[1]});if(t.length===5||t.length>5){var i=0,s=0,o=0,u=t[2].xy,a=t[3].xy,f=t[4].xy;for(var c=1;c<r;c++){i=1/r*c;s=(1-i)*(1-i)*u[0]+2*i*(1-i)*a[0]+i*i*f[0];o=(1-i)*(1-i)*u[1]+2*i*(1-i)*a[1]+i*i*f[1];n.push({x:s,y:o})}n.push({x:f[0],y:f[1]})}this.bezie=n});this.ALL_FRAMES=n},calculateEdgeSkewY:function(){var t=this;var n=this.CFG.BOOK_HEIGHT;var r=this.CFG.YSCALE;var i=this.CFG.YSCALETOP;var s=this.ALL_FRAMES;e.each(s,function(e){var t=this.bezie;var s=[];var o=[];var u=[];for(var a=0;a<t.length-1;a++){var f,l,c,h;f=t[a];l=t[a+1];var p=Math.sqrt((l.y-f.y)*(l.y-f.y)+(l.x-f.x)*(l.x-f.x));var d=(Math.atan2(l.y-f.y,l.x-f.x)*180/Math.PI).toFixed(15);u.push({x:f.x,z:f.y,width:p,angle:d});c=f.y*i-n;h=l.y*i-n;s.push((Math.atan2(h-c,l.x-f.x)*180/Math.PI).toFixed(15));y1bottom=f.y*r-n;y2bottom=l.y*r-n;o.push((Math.atan2(y2bottom-y1bottom,l.x-f.x)*180/Math.PI).toFixed(15))}this.edges3d=u;this.skewYtop=s;this.skewYbottom=o});this.ALL_FRAMES=s},get_total_keyframes:function(){var e=this.ARR_ANIMATIONS[this.CURRENT_ANIMATION];return e.length},get_total_lines:function(){var e=this.ALL_FRAMES[this.FIRST_KEYFRAME].line;return e.length}};var u={init:function(){this.SIN=[];this.COS=[];this._calculate();return this},_calculate:function(){for(var e=0;e<360;e++){this.SIN[e]=Math.sin(e*Math.PI/180).toFixed(15)}for(var e=0;e<360;e++){this.COS[e]=Math.cos(e*Math.PI/180).toFixed(15)}(function(e){if(!e.map){e.map=function(e){var t=this.length;var n=new Array(t);for(var r=0;r<t;r++){if(r in this){n[r]=e.call(false,this[r],r,this)}}return n}}})(Array.prototype)},xy_matrix2d:function(e,t){var n=e;n.push(1);var r=t;return[r[0]*n[0]+r[1]*n[1]+r[2]*n[2],r[3]*n[0]+r[4]*n[1]+r[5]*n[2]]}};var a=window[i].NUMBER;window[i].NUMBER+=1;window[i].queueBooksBuilding.push({arrSrc:t,options:n,target:r});if(!a||!window[i].buildingNowFlag){window[i].buildNextBook()}return this};e.fn.onebook=function(t,n){e.onebook(t,n,this);return this}})(jQuery);